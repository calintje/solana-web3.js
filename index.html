<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Solana JavaScript SDK</title><meta name="description" content="Documentation for Solana JavaScript SDK"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Solana JavaScript SDK</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>Solana JavaScript SDK</h1></div><div class="tsd-panel tsd-typography"><p><a href="https://www.npmjs.com/package/@solana/web3.js/v/rc" target="_blank" class="external"><img src="https://img.shields.io/npm/v/@solana/web3.js/rc.svg?style=flat" alt="npm"></a>
<a href="https://www.npmjs.com/package/@solana/web3.js/v/rc" target="_blank" class="external"><img src="https://img.shields.io/npm/dm/@solana/web3.js/rc.svg?style=flat" alt="npm-downloads"></a>
<br />
<a href="https://github.com/prettier/prettier" target="_blank" class="external"><img src="https://img.shields.io/badge/code_style-prettier-ff69b4.svg?style=flat-square" alt="code-style-prettier"></a></p>
<a id="md:solana-javascript-sdk" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Solana JavaScript SDK<a href="#md:solana-javascript-sdk" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This is the JavaScript SDK for building Solana apps for Node, web, and React Native.</p>
<blockquote>
<p>[!NOTE]
The code for the 1.x line of this library can be found <a href="https://github.com/solana-labs/solana-web3.js/tree/maintenance/v1.x" target="_blank" class="external">here</a> and the documentation <a href="https://solana-labs.github.io/solana-web3.js/v1.x" target="_blank" class="external">here</a>.</p>
</blockquote>
<a id="md:installation" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>For use in a Node.js or web application:</p>
<pre><code class="shell"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-3">--save</span><span class="hl-1"> </span><span class="hl-2">@solana/web3.js@rc</span>
</code><button type="button">Copy</button></pre>

<p>For use in a browser, without a build system:</p>
<pre><code class="html"><span class="hl-4">&lt;!-- Development (debug mode, unminified) --&gt;</span><br/><span class="hl-5">&lt;</span><span class="hl-6">script</span><span class="hl-7"> </span><span class="hl-8">src</span><span class="hl-7">=</span><span class="hl-9">&quot;https://unpkg.com/@solana/web3.js@rc/dist/index.development.js&quot;</span><span class="hl-5">&gt;&lt;/</span><span class="hl-6">script</span><span class="hl-5">&gt;</span><br/><br/><span class="hl-4">&lt;!-- Production (minified) --&gt;</span><br/><span class="hl-5">&lt;</span><span class="hl-6">script</span><span class="hl-7"> </span><span class="hl-8">src</span><span class="hl-7">=</span><span class="hl-9">&quot;https://unpkg.com/@solana/web3.js@rc/dist/index.production.min.js&quot;</span><span class="hl-5">&gt;&lt;/</span><span class="hl-6">script</span><span class="hl-5">&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="md:examples" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Examples<a href="#md:examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>To get a feel for the API, run and modify the live examples in the <code>examples/</code> directory. There, you will find a series of single-purpose Node scripts that demonstrate a specific feature or use case. You will also find a React application that you can run in a browser, that demonstrates being able to create, sign, and send transactions using browser wallets.</p>
<a id="md:whats-new-in-version-20" class="tsd-anchor"></a><h1 class="tsd-anchor-link">What's New in Version 2.0<a href="#md:whats-new-in-version-20" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Version 2.0 of the Solana JavaScript SDK is a response to many of the pain points you have communicated to us when developing Solana applications with web3.js.</p>
<a id="md:tree-shakability" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Tree-Shakability<a href="#md:tree-shakability" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The object-oriented design of the web3.js (1.x) API prevents optimizing compilers from being able to ‘tree-shake’ unused code from your production builds. No matter how much of the web3.js API you use in your application, you have until now been forced to package all of it.</p>
<p>Read more about tree-shaking here:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Tree_shaking" target="_blank" class="external">Mozilla Developer Docs: Tree Shaking</a></li>
<li><a href="https://webpack.js.org/guides/tree-shaking/" target="_blank" class="external">WebPack Docs: Tree Shaking</a></li>
<li><a href="https://web.dev/articles/reduce-javascript-payloads-with-tree-shaking" target="_blank" class="external">Web.Dev Blog Article: Reduce JavaScript Payloads with Tree Shaking</a></li>
</ul>
<p>One example of an API that can’t be tree-shaken is the <code>Connection</code> class. It has dozens of methods, but because it’s a <em>class</em> you have no choice but to include every method in your application’s final bundle, no matter how many you <em>actually</em> use.</p>
<p>Needlessly large JavaScript bundles can cause issues with deployments to cloud compute providers like Cloudflare or AWS Lambda. They also impact webapp startup performance because of longer download and JavaScript parse times.</p>
<p>Version 2.0 is fully tree-shakable and will remain so, enforced by build-time checks. Optimizing compilers can now eliminate those parts of the library that your application does not use.</p>
<p>The new library itself is comprised of several smaller, modular packages under the <code>@solana</code> organization, including:</p>
<ul>
<li><code>@solana/accounts</code>: For fetching and decoding accounts</li>
<li><code>@solana/codecs</code>: For composing data (de)serializers from a set of primitives or building custom ones</li>
<li><code>@solana/errors</code>: For identifying and refining coded errors thrown in the <code>@solana</code> namespace</li>
<li><code>@solana/rpc</code>: For sending RPC requests</li>
<li><code>@solana/rpc-subscriptions</code>: For subscribing to RPC notifications</li>
<li><code>@solana/signers</code>: For building message and/or transaction signer objects</li>
<li><code>@solana/sysvars</code>: For fetching and decoding sysvar accounts</li>
<li><code>@solana/transaction-messages</code>: For building and transforming Solana transaction message objects</li>
<li><code>@solana/transactions</code>: For compiling and signing transactions for submission to the network</li>
<li>And many more!</li>
</ul>
<p>Some of these packages are themselves composed of smaller packages. For instance, <code>@solana/rpc</code> is composed of <code>@solana/rpc-spec</code> (for core JSON RPC specification types), <code>@solana/rpc-api</code> (for the Solana-specific RPC methods), <code>@solana/rpc-transport-http</code> (for the default HTTP transport) and so on.</p>
<p>Developers can use the default configurations within the main library (<code>@solana/web3.js@rc</code>) or import any of its subpackages where customization-through-composition is desired.</p>
<a id="md:composable-internals" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Composable Internals<a href="#md:composable-internals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Depending on your use case and your tolerance for certain application behaviours, you may wish to configure your application to make a different set of tradeoffs than another developer. The web3.js (1.x) API imposed a rigid set of common-case defaults on <em>all</em> developers, some of which were impossible to change.</p>
<p>The inability to customize web3.js up until now has been a source of frustration:</p>
<ul>
<li>The Mango team wanted to customize the transaction confirmation strategy, but all of that functionality is hidden away behind <code>confirmTransaction</code> – a static method of <code>Connection</code>. <a href="https://github.com/solana-labs/solana-web3.js/blob/69a8ad25ef09f9e6d5bff1ffa8428d9be0bd32ac/packages/library-legacy/src/connection.ts#L3734" target="_blank" class="external">Here’s the code for <code>confirmTransaction</code> on GitHub</a>.</li>
<li>Solana developer ‘mPaella’ <a href="https://github.com/solana-labs/solana-web3.js/issues/1143#issuecomment-1435927152" target="_blank" class="external">wanted us to add a feature in the RPC</a> that would failover to a set of backup URLs in case the primary one failed.</li>
<li>Solana developer ‘epicfaace’ wanted first-class support for automatic time-windowed batching in the RPC transport. <a href="https://github.com/solana-labs/solana/pull/23628" target="_blank" class="external">Here’s their pull request</a>.</li>
<li>Multiple folks have expressed the need for custom retry logic for failed requests or transactions. <a href="https://github.com/solana-labs/solana/pull/11811" target="_blank" class="external">Here’s a pull request from ‘dafyddd’</a> and <a href="https://github.com/solana-labs/solana-web3.js/issues/1041" target="_blank" class="external">another from ‘abrkn’</a> attempting to modify retry logic to suit their individual use cases.</li>
</ul>
<p>Version 2.0 exposes far more of its internals, particularly where communication with an RPC is concerned, and allows willing developers the ability to compose new implementations from the default ones that manifest a nearly limitless array of customizations.</p>
<p>The individual modules that make up web3.js are assembled in a <strong>default</strong> configuration reminiscent of the legacy library as part of the npm package <code>@solana/web3.js@rc</code>, but those who wish to assemble them in different configurations may do so.</p>
<p>Generic types are offered in numerous places, allowing you to specify new functionality, to make extensions to each API via composition and supertypes, and to encourage you to create higher-level opinionated abstractions of your own.</p>
<p>In fact, we expect you to do so, and to open source some of those for use by others with similar needs.</p>
<a id="md:modern-javascript-zero-dependency" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Modern JavaScript; Zero-Dependency<a href="#md:modern-javascript-zero-dependency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The advance of modern JavaScript features presents an opportunity to developers of crypto applications, such as the ability to use native Ed25519 keys and to express large values as native <code>bigint</code>.</p>
<p>The Web Incubator Community Group has advocated for the addition of Ed25519 support to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API" target="_blank" class="external">Web Crypto API</a>, and support has already landed in <em>most</em> modern JavaScript runtimes.</p>
<p>Engine support for <code>bigint</code> values has also become commonplace. The older <code>number</code> primitive in JavaScript has a maximum value of 2^53 - 1, whereas Rust’s <code>u64</code> can represent values up to 2^64.</p>
<p>Version 2.0 eliminates userspace implementations of Ed25519 cryptography, large number polyfills, and more, in favour of custom implementations or the use of native JavaScript features, reducing the size of the library. It has no third-party dependencies.</p>
<a id="md:functional-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Functional Architecture<a href="#md:functional-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The object oriented, class-based architecture of web3.js (1.x) causes unnecessary bundle bloat. Your application has no choice but to bundle <em>all</em> of the functionality and dependencies of a class no matter how many methods you actually use at runtime.</p>
<p>Class-based architecture also presents unique risks to developers who trigger the dual-package hazard. This describes a situation you can find yourself in if you build for both CommonJS and ES modules. It arises when two copies of the same class are present in the dependency tree, causing checks like <code>instanceof</code> to fail. This introduces aggravating and difficult to debug problems.</p>
<p>Read more about dual-package hazard:</p>
<ul>
<li><a href="https://nodejs.org/api/packages.html#dual-package-hazard" target="_blank" class="external">NodeJS: Dual Package Hazard</a></li>
</ul>
<p>Version 2.0 implements no classes (with the notable exception of the <code>SolanaError</code> class) and implements the thinnest possible interfaces at function boundaries.</p>
<a id="md:statistics" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Statistics<a href="#md:statistics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Consider these statistical comparisons between version 2.0 and the legacy 1.x.</p>
<table>
<thead>
<tr>
<th></th>
<th>1.x (Legacy)</th>
<th>2.0</th>
<th>+/- %</th>
</tr>
</thead>
<tbody>
<tr>
<td>Total minified size of library</td>
<td>81 KB</td>
<td>57.5 KB</td>
<td>-29%</td>
</tr>
<tr>
<td>Total minified size of library (when runtime supports Ed25519)</td>
<td>81 KB</td>
<td>53 KB</td>
<td>-33%</td>
</tr>
<tr>
<td>Bundled size of a web application that executes a transfer of lamports</td>
<td>111 KB</td>
<td>23.9 KB</td>
<td>-78%</td>
</tr>
<tr>
<td>Bundled size of a web application that executes a transfer of lamports (when runtime supports Ed25519)</td>
<td>111 KB</td>
<td>18.2 KB</td>
<td>-83%</td>
</tr>
<tr>
<td>Performance of key generation, signing, and verifying signatures (Brave with Experimental API flag)</td>
<td>700 ops/s</td>
<td>7000 ops/s</td>
<td>+900%</td>
</tr>
<tr>
<td>First-load size for Solana Explorer</td>
<td>311 KB</td>
<td>228 KB</td>
<td>-26%</td>
</tr>
</tbody>
</table>
<p>The re-engineered library achieves these speedups and reductions in bundle size in large part through use of modern JavaScript APIs.</p>
<p>To validate our work, we replaced the legacy 1.x library with the new 2.0 library on the homepage of the Solana Explorer. Total first-load bundle size dropped by 26% without removing a single feature. <a href="https://twitter.com/callum_codes/status/1679124485218226176" target="_blank" class="external">Here’s an X thread</a> by Callum McIntyre if you would like to dig deeper.</p>
<a id="md:a-tour-of-the-version-20-api" class="tsd-anchor"></a><h1 class="tsd-anchor-link">A Tour of the Version 2.0 API<a href="#md:a-tour-of-the-version-20-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Here’s an overview of how to use the new library to interact with the RPC, configure network transports, work with Ed25519 keys, and to serialize data.</p>
<a id="md:rpc" class="tsd-anchor"></a><h2 class="tsd-anchor-link">RPC<a href="#md:rpc" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Version 2.0 ships with an implementation of the <a href="https://www.jsonrpc.org/specification" target="_blank" class="external">JSON RPC specification</a> and a type spec for the <a href="https://docs.solana.com/api" target="_blank" class="external">Solana JSON RPC</a>.</p>
<p>The main package responsible for managing communication with an RPC is <code>@solana/rpc</code>. However, this package makes use of more granular packages to break down the RPC logic into smaller pieces. Namely, these packages are:</p>
<ul>
<li><code>@solana/rpc</code>: Contains all logic related to sending Solana RPC calls.</li>
<li><code>@solana/rpc-api</code>: Describes all Solana RPC methods using types.</li>
<li><code>@solana/rpc-transport-http</code>: Provides a concrete implementation of an RPC transport using HTTP requests.</li>
<li><code>@solana/rpc-spec</code>: Defines the JSON RPC spec for sending RPC requests.</li>
<li><code>@solana/rpc-spec-types</code>: Shared JSON RPC specifications types and helpers that are used by both <code>@solana/rpc</code> and <code>@solana/rpc-subscriptions</code> (described in the next section).</li>
<li><code>@solana/rpc-types</code>: Shared Solana RPC types and helpers that are used by both <code>@solana/rpc</code> and <code>@solana/rpc-subscriptions</code>.</li>
</ul>
<p>The main <code>@solana/web3.js</code> package re-exports the <code>@solana/rpc</code> package so, going forward, we will import RPC types and functions from the library directly.</p>
<a id="md:rpc-calls" class="tsd-anchor"></a><h3 class="tsd-anchor-link">RPC Calls<a href="#md:rpc-calls" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You can use the <code>createSolanaRpc</code> function by providing the URL of a Solana JSON RPC server. This will create a default client for interacting with the Solana JSON RPC API.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpc</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create an RPC client.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpc</span><span class="hl-1">(</span><span class="hl-2">&#39;http://127.0.0.1:8899&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">//    ^? Rpc&lt;SolanaRpcApi&gt;</span><br/><br/><span class="hl-4">// Send a request.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">slot</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpc</span><span class="hl-1">.</span><span class="hl-0">getSlot</span><span class="hl-1">().</span><span class="hl-0">send</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:custom-rpc-transports" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom RPC Transports<a href="#md:custom-rpc-transports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>createSolanaRpc</code> function communicates with the RPC server using a default HTTP transport that should satisfy most use cases. You can provide your own transport or wrap an existing one to communicate with RPC servers in any way you see fit. In the example below, we explicitly create a transport and use it to create a new RPC client via the <code>createSolanaRpcFromTransport</code> function.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpcFromTransport</span><span class="hl-1">, </span><span class="hl-11">createDefaultRpcTransport</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create an HTTP transport or any custom transport of your choice.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transport</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://api.devnet.solana.com&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-4">// Create an RPC client using that transport.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcFromTransport</span><span class="hl-1">(</span><span class="hl-11">transport</span><span class="hl-1">);</span><br/><span class="hl-4">//    ^? Rpc&lt;SolanaRpcApi&gt;</span><br/><br/><span class="hl-4">// Send a request.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">slot</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpc</span><span class="hl-1">.</span><span class="hl-0">getSlot</span><span class="hl-1">().</span><span class="hl-0">send</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>A custom transport can implement specialized functionality such as coordinating multiple transports, implementing retries, and more. Let's take a look at some concrete examples.</p>
<a id="md:round-robin" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Round Robin<a href="#md:round-robin" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>A ‘round robin’ transport is one that distributes requests to a list of endpoints in sequence.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createDefaultRpcTransport</span><span class="hl-1">, </span><span class="hl-11">createSolanaRpcFromTransport</span><span class="hl-1">, </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">RpcTransport</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create an HTTP transport for each RPC server.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transports</span><span class="hl-1"> = [</span><br/><span class="hl-1">    </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet-beta.my-server-1.com&#39;</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet-beta.my-server-2.com&#39;</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet-beta.my-server-3.com&#39;</span><span class="hl-1"> }),</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-4">// Set up the round-robin transport.</span><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-11">nextTransport</span><span class="hl-1"> = </span><span class="hl-13">0</span><span class="hl-1">;</span><br/><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">roundRobinTransport</span><span class="hl-1">&lt;</span><span class="hl-14">TResponse</span><span class="hl-1">&gt;(...</span><span class="hl-11">args</span><span class="hl-1">: </span><span class="hl-14">Parameters</span><span class="hl-1">&lt;</span><span class="hl-14">RpcTransport</span><span class="hl-1">&gt;): </span><span class="hl-14">Promise</span><span class="hl-1">&lt;</span><span class="hl-14">TResponse</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transport</span><span class="hl-1"> = </span><span class="hl-11">transports</span><span class="hl-1">[</span><span class="hl-11">nextTransport</span><span class="hl-1">];</span><br/><span class="hl-1">    </span><span class="hl-11">nextTransport</span><span class="hl-1"> = (</span><span class="hl-11">nextTransport</span><span class="hl-1"> + </span><span class="hl-13">1</span><span class="hl-1">) % </span><span class="hl-11">transports</span><span class="hl-1">.</span><span class="hl-11">length</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">transport</span><span class="hl-1">(...</span><span class="hl-11">args</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// Create an RPC client using the round-robin transport.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcFromTransport</span><span class="hl-1">(</span><span class="hl-11">roundRobinTransport</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:sharding" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Sharding<a href="#md:sharding" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>A sharding transport is a kind of distributing transport that sends requests to a particular server based on something about the request itself. Here’s an example that sends requests to different servers depending on the name of the method:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createDefaultRpcTransport</span><span class="hl-1">, </span><span class="hl-11">createSolanaRpcFromTransport</span><span class="hl-1">, </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">RpcTransport</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create multiple transports.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transportA</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet-beta.my-server-1.com&#39;</span><span class="hl-1"> });</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transportB</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet-beta.my-server-2.com&#39;</span><span class="hl-1"> });</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transportC</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet-beta.my-server-3.com&#39;</span><span class="hl-1"> });</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transportD</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet-beta.my-server-4.com&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-4">// Function to determine which shard to use based on the request method.</span><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">selectShard</span><span class="hl-1">(</span><span class="hl-11">method</span><span class="hl-1">: </span><span class="hl-14">string</span><span class="hl-1">): </span><span class="hl-14">RpcTransport</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">switch</span><span class="hl-1"> (</span><span class="hl-11">method</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">case</span><span class="hl-1"> </span><span class="hl-2">&#39;getAccountInfo&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-10">case</span><span class="hl-1"> </span><span class="hl-2">&#39;getBalance&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-11">transportA</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-10">case</span><span class="hl-1"> </span><span class="hl-2">&#39;getLatestBlockhash&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-10">case</span><span class="hl-1"> </span><span class="hl-2">&#39;getTransaction&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-11">transportB</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-10">case</span><span class="hl-1"> </span><span class="hl-2">&#39;sendTransaction&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-11">transportC</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-10">default</span><span class="hl-1">:</span><br/><span class="hl-1">            </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-11">transportD</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// Create a transport that selects the correct transport given the request method name.</span><br/><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">shardingTransport</span><span class="hl-1">&lt;</span><span class="hl-14">TResponse</span><span class="hl-1">&gt;(...</span><span class="hl-11">args</span><span class="hl-1">: </span><span class="hl-14">Parameters</span><span class="hl-1">&lt;</span><span class="hl-14">RpcTransport</span><span class="hl-1">&gt;): </span><span class="hl-14">Promise</span><span class="hl-1">&lt;</span><span class="hl-14">TResponse</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">payload</span><span class="hl-1"> = </span><span class="hl-11">args</span><span class="hl-1">[</span><span class="hl-13">0</span><span class="hl-1">].</span><span class="hl-11">payload</span><span class="hl-1"> </span><span class="hl-10">as</span><span class="hl-1"> { </span><span class="hl-11">method</span><span class="hl-1">: </span><span class="hl-14">string</span><span class="hl-1"> };</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">selectedTransport</span><span class="hl-1"> = </span><span class="hl-0">selectShard</span><span class="hl-1">(</span><span class="hl-11">payload</span><span class="hl-1">.</span><span class="hl-11">method</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> (</span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">selectedTransport</span><span class="hl-1">(...</span><span class="hl-11">args</span><span class="hl-1">)) </span><span class="hl-10">as</span><span class="hl-1"> </span><span class="hl-14">TResponse</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// Create an RPC client using the sharding transport.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcFromTransport</span><span class="hl-1">(</span><span class="hl-11">shardingTransport</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:retry" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Retry<a href="#md:retry" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>A custom transport is a good place to implement global retry logic for every request:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createDefaultRpcTransport</span><span class="hl-1">, </span><span class="hl-11">createSolanaRpcFromTransport</span><span class="hl-1">, </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">RpcTransport</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Set the maximum number of attempts to retry a request.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">MAX_ATTEMPTS</span><span class="hl-1"> = </span><span class="hl-13">4</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create the default transport.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">defaultTransport</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet-beta.my-server-1.com&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-4">// Sleep function to wait for a given number of milliseconds.</span><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">sleep</span><span class="hl-1">(</span><span class="hl-11">ms</span><span class="hl-1">: </span><span class="hl-14">number</span><span class="hl-1">): </span><span class="hl-14">Promise</span><span class="hl-1">&lt;</span><span class="hl-14">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-14">Promise</span><span class="hl-1">(</span><span class="hl-11">resolve</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">setTimeout</span><span class="hl-1">(</span><span class="hl-11">resolve</span><span class="hl-1">, </span><span class="hl-11">ms</span><span class="hl-1">));</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// Calculate the delay for a given attempt.</span><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">calculateRetryDelay</span><span class="hl-1">(</span><span class="hl-11">attempt</span><span class="hl-1">: </span><span class="hl-14">number</span><span class="hl-1">): </span><span class="hl-14">number</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">// Exponential backoff with a maximum of 1.5 seconds.</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-11">Math</span><span class="hl-1">.</span><span class="hl-0">min</span><span class="hl-1">(</span><span class="hl-13">100</span><span class="hl-1"> * </span><span class="hl-11">Math</span><span class="hl-1">.</span><span class="hl-0">pow</span><span class="hl-1">(</span><span class="hl-13">2</span><span class="hl-1">, </span><span class="hl-11">attempt</span><span class="hl-1">), </span><span class="hl-13">1500</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// A retrying transport that will retry up to MAX_ATTEMPTS times before failing.</span><br/><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">retryingTransport</span><span class="hl-1">&lt;</span><span class="hl-14">TResponse</span><span class="hl-1">&gt;(...</span><span class="hl-11">args</span><span class="hl-1">: </span><span class="hl-14">Parameters</span><span class="hl-1">&lt;</span><span class="hl-14">RpcTransport</span><span class="hl-1">&gt;): </span><span class="hl-14">Promise</span><span class="hl-1">&lt;</span><span class="hl-14">TResponse</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-11">requestError</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">for</span><span class="hl-1"> (</span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-11">attempts</span><span class="hl-1"> = </span><span class="hl-13">0</span><span class="hl-1">; </span><span class="hl-11">attempts</span><span class="hl-1"> &lt; </span><span class="hl-12">MAX_ATTEMPTS</span><span class="hl-1">; </span><span class="hl-11">attempts</span><span class="hl-1">++) {</span><br/><span class="hl-1">        </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">defaultTransport</span><span class="hl-1">(...</span><span class="hl-11">args</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-11">err</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-11">requestError</span><span class="hl-1"> = </span><span class="hl-11">err</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-4">// Only sleep if we have more attempts remaining.</span><br/><span class="hl-1">            </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-11">attempts</span><span class="hl-1"> &lt; </span><span class="hl-12">MAX_ATTEMPTS</span><span class="hl-1"> - </span><span class="hl-13">1</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">retryDelay</span><span class="hl-1"> = </span><span class="hl-0">calculateRetryDelay</span><span class="hl-1">(</span><span class="hl-11">attempts</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">sleep</span><span class="hl-1">(</span><span class="hl-11">retryDelay</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-10">throw</span><span class="hl-1"> </span><span class="hl-11">requestError</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// Create the RPC client using the retrying transport.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcFromTransport</span><span class="hl-1">(</span><span class="hl-11">retryingTransport</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:failover" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Failover<a href="#md:failover" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Support for handling network failures can be implemented in the transport itself. Here’s an example of some failover logic integrated into a transport:</p>
<pre><code class="ts"><span class="hl-4">// TODO: Your turn; send us a pull request with an example.</span>
</code><button type="button">Copy</button></pre>

<a id="md:augmentingconstraining-the-rpc-api" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Augmenting/Constraining the RPC API<a href="#md:augmentingconstraining-the-rpc-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Using the <code>createSolanaRpc</code> or <code>createSolanaRpcFromTransport</code> methods, we always get the same API that includes the Solana RPC API methods. Since the RPC API is described using types only, it is possible to augment those types to add your own methods.</p>
<p>When constraining the API scope, keep in mind that types don’t affect bundle size. You may still like to constrain the type-spec for a variety of reasons, including reducing TypeScript noise.</p>
<a id="md:constraining-by-cluster" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Constraining by Cluster<a href="#md:constraining-by-cluster" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If you're using a specific cluster, you may wrap your RPC URL inside a helper function like <code>mainnet</code> or <code>devnet</code> to inject that information into the RPC type system.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpc</span><span class="hl-1">, </span><span class="hl-11">mainnet</span><span class="hl-1">, </span><span class="hl-11">devnet</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">mainnetRpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpc</span><span class="hl-1">(</span><span class="hl-0">mainnet</span><span class="hl-1">(</span><span class="hl-2">&#39;https://api.mainnet-beta.solana.com&#39;</span><span class="hl-1">));</span><br/><span class="hl-4">//    ^? RpcMainnet&lt;SolanaRpcApiMainnet&gt;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">devnetRpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpc</span><span class="hl-1">(</span><span class="hl-0">devnet</span><span class="hl-1">(</span><span class="hl-2">&#39;https://api.devnet.solana.com&#39;</span><span class="hl-1">));</span><br/><span class="hl-4">//    ^? RpcDevnet&lt;SolanaRpcApiDevnet&gt;</span>
</code><button type="button">Copy</button></pre>

<p>In the example above, <code>devnetRpc.requestAirdrop(..)</code> will work, but <code>mainnetRpc.requestAirdrop(..)</code> will raise a TypeScript error since <code>requestAirdrop</code> is not a valid method of the mainnet cluster.</p>
<a id="md:cherry-picking-api-methods" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Cherry-Picking API Methods<a href="#md:cherry-picking-api-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>You can constrain the API’s type-spec even further so you are left only with the methods you need. The simplest way to do this is to cast the created RPC client to a type that only includes the required methods.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpc</span><span class="hl-1">, </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">Rpc</span><span class="hl-1">, </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">GetAccountInfoApi</span><span class="hl-1">, </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">GetMultipleAccountsApi</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpc</span><span class="hl-1">(</span><span class="hl-2">&#39;http://127.0.0.1:8899&#39;</span><span class="hl-1">) </span><span class="hl-10">as</span><span class="hl-1"> </span><span class="hl-14">Rpc</span><span class="hl-1">&lt;</span><span class="hl-14">GetAccountInfoApi</span><span class="hl-1"> &amp; </span><span class="hl-14">GetMultipleAccountsApi</span><span class="hl-1">&gt;;</span>
</code><button type="button">Copy</button></pre>

<p>Alternatively, you can explicitly create the RPC API using the <code>createSolanaRpcApi</code> function. You will need to create your own transport and bind the two together using the <code>createRpc</code> function.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-11">createDefaultRpcTransport</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createRpc</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createSolanaRpcApi</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">DEFAULT_RPC_CONFIG</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">GetAccountInfoApi</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">GetMultipleAccountsApi</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">api</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcApi</span><span class="hl-1">&lt;</span><span class="hl-14">GetAccountInfoApi</span><span class="hl-1"> &amp; </span><span class="hl-14">GetMultipleAccountsApi</span><span class="hl-1">&gt;(</span><span class="hl-12">DEFAULT_RPC_CONFIG</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transport</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({ </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;http:127.0.0.1:8899&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createRpc</span><span class="hl-1">({ </span><span class="hl-11">api</span><span class="hl-1">, </span><span class="hl-11">transport</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p>Note that the <code>createSolanaRpcApi</code> function is a wrapper on top of the <code>createJsonRpcApi</code> function which adds some Solana-specific transformers such as setting a default commitment on all methods or throwing an error when an integer overflow is detected.</p>
<a id="md:creating-your-own-api-methods" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Creating Your Own API Methods<a href="#md:creating-your-own-api-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The new library’s RPC specification supports an <em>infinite</em> number of JSON-RPC methods with <strong>zero increase</strong> in bundle size.</p>
<p>This means the library can support future additions to the official <a href="https://docs.solana.com/api" target="_blank" class="external">Solana JSON RPC</a>, or <a href="https://docs.helius.dev/compression-and-das-api/digital-asset-standard-das-api/get-asset" target="_blank" class="external">custom RPC methods</a> defined by some RPC provider.</p>
<p>Here’s an example of how a developer at might build a custom RPC type-spec for an RPC provider's implementation of the Metaplex Digital Asset Standard's <code>getAsset</code> method:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">RpcApiMethods</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Define the method&#39;s response payload.</span><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-14">GetAssetApiResponse</span><span class="hl-1"> = </span><span class="hl-14">Readonly</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">    </span><span class="hl-11">interface</span><span class="hl-1">: </span><span class="hl-14">DasApiAssetInterface</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-11">id</span><span class="hl-1">: </span><span class="hl-14">Address</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-11">content</span><span class="hl-1">: </span><span class="hl-14">Readonly</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">        </span><span class="hl-11">files</span><span class="hl-1">?: </span><span class="hl-3">readonly</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-11">mime</span><span class="hl-1">?: </span><span class="hl-14">string</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-11">uri</span><span class="hl-1">?: </span><span class="hl-14">string</span><span class="hl-1">;</span><br/><span class="hl-1">            [</span><span class="hl-11">key</span><span class="hl-1">: </span><span class="hl-14">string</span><span class="hl-1">]: </span><span class="hl-14">unknown</span><span class="hl-1">;</span><br/><span class="hl-1">        }[];</span><br/><span class="hl-1">        </span><span class="hl-11">json_uri</span><span class="hl-1">: </span><span class="hl-14">string</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-11">links</span><span class="hl-1">?: </span><span class="hl-3">readonly</span><span class="hl-1"> {</span><br/><span class="hl-1">            [</span><span class="hl-11">key</span><span class="hl-1">: </span><span class="hl-14">string</span><span class="hl-1">]: </span><span class="hl-14">unknown</span><span class="hl-1">;</span><br/><span class="hl-1">        }[];</span><br/><span class="hl-1">        </span><span class="hl-11">metadata</span><span class="hl-1">: </span><span class="hl-14">DasApiMetadata</span><span class="hl-1">;</span><br/><span class="hl-1">    }&gt;;</span><br/><span class="hl-1">    </span><span class="hl-4">/* ...etc... */</span><br/><span class="hl-1">}&gt;;</span><br/><br/><span class="hl-4">// Set up a type spec for the request method.</span><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-14">GetAssetApi</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">// Define the method&#39;s name, parameters and response type</span><br/><span class="hl-1">    </span><span class="hl-0">getAsset</span><span class="hl-1">(</span><span class="hl-11">args</span><span class="hl-1">: { </span><span class="hl-11">id</span><span class="hl-1">: </span><span class="hl-14">Address</span><span class="hl-1"> }): </span><span class="hl-14">GetAssetApiResponse</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">// Export the type spec for downstream users.</span><br/><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-14">MetaplexDASApi</span><span class="hl-1"> = </span><span class="hl-14">GetAssetApi</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Here’s how a developer might use it:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createDefaultRpcTransport</span><span class="hl-1">, </span><span class="hl-11">createRpc</span><span class="hl-1">, </span><span class="hl-11">createJsonRpcApi</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create the custom API.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">api</span><span class="hl-1"> = </span><span class="hl-0">createJsonRpcApi</span><span class="hl-1">&lt;</span><span class="hl-14">MetaplexDASApi</span><span class="hl-1">&gt;();</span><br/><br/><span class="hl-4">// Set up an HTTP transport to a server that supports the custom API.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transport</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcTransport</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://mainnet.helius-rpc.com/?api-key=&lt;api_key&gt;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// Create the RPC client.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">metaplexDASRpc</span><span class="hl-1"> = </span><span class="hl-0">createRpc</span><span class="hl-1">({ </span><span class="hl-11">api</span><span class="hl-1">, </span><span class="hl-11">transport</span><span class="hl-1"> });</span><br/><span class="hl-4">//    ^? Rpc&lt;MetaplexDASApi&gt;</span>
</code><button type="button">Copy</button></pre>

<p>As long as a particular JSON RPC method adheres to the <a href="https://www.jsonrpc.org/specification" target="_blank" class="external">official JSON RPC specification</a>, it will be supported by version 2.0.</p>
<a id="md:aborting-rpc-requests" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Aborting RPC Requests<a href="#md:aborting-rpc-requests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>RPC requests are now abortable with modern <code>AbortControllers</code>. When calling an RPC method such as <code>getSlot</code>, it will return a <code>PendingRpcRequest</code> proxy object that contains a <code>send</code> method to send the request to the server.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">pendingRequest</span><span class="hl-1">: </span><span class="hl-14">PendingRpcRequest</span><span class="hl-1">&lt;</span><span class="hl-14">Slot</span><span class="hl-1">&gt; = </span><span class="hl-11">rpc</span><span class="hl-1">.</span><span class="hl-0">getSlot</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">slot</span><span class="hl-1">: </span><span class="hl-14">Slot</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">pendingRequest</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>The arguments of the <code>getSlot</code> method are reserved for the request payload, but the <code>send</code> method is where additional arguments such as an <code>AbortSignal</code> can be accepted in the context of the request.</p>
<p>Aborting RPC requests can be useful for a variety of things such as setting a timeout on a request or cancelling a request when a user navigates away from a page.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpc</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpc</span><span class="hl-1">(</span><span class="hl-2">&#39;http://127.0.0.1:8900&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Create a new AbortController.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">abortController</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">AbortController</span><span class="hl-1">();</span><br/><br/><span class="hl-4">// Abort the request when the user navigates away from the current page.</span><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">onUserNavigateAway</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-11">abortController</span><span class="hl-1">.</span><span class="hl-0">abort</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// The request will be aborted if and only if the user navigates away from the page.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">slot</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpc</span><span class="hl-1">.</span><span class="hl-0">getSlot</span><span class="hl-1">().</span><span class="hl-0">send</span><span class="hl-1">({ </span><span class="hl-11">abortSignal:</span><span class="hl-1"> </span><span class="hl-11">abortController</span><span class="hl-1">.</span><span class="hl-11">signal</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p>Read more about <code>AbortController</code> here:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" target="_blank" class="external">Mozilla Developer Docs: <code>AbortController</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal" target="_blank" class="external">Mozilla Developer Docs: <code>AbortSignal</code></a></li>
<li><a href="https://javascript.info/fetch-abort" target="_blank" class="external">JavaScript.info: Fetch: Abort</a></li>
</ul>
<a id="md:rpc-subscriptions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">RPC Subscriptions<a href="#md:rpc-subscriptions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Subscriptions in the legacy library do not allow custom retry logic and do not allow you to recover from potentially missed messages. The new version does away with silent retries, surfaces transport errors to your application, and gives you the opportunity to recover from gap events.</p>
<p>The main package responsible for managing communication with RPC subscriptions is <code>@solana/rpc-subscriptions</code>. However, similarly to <code>@solana/rpc</code>, this package also makes use of more granular packages. These packages are:</p>
<ul>
<li><code>@solana/rpc-subscriptions</code>: Contains all logic related to subscribing to Solana RPC notifications.</li>
<li><code>@solana/rpc-subscriptions-api</code>: Describes all Solana RPC subscriptions using types.</li>
<li><code>@solana/rpc-subscriptions-channel-websocket</code>: Provides a concrete implementation of an RPC Subscriptions channel using WebSockets.</li>
<li><code>@solana/rpc-subscriptions-spec</code>: Defines the JSON RPC spec for subscribing to RPC notifications.</li>
<li><code>@solana/rpc-spec-types</code>: Shared JSON RPC specifications types and helpers that are used by both <code>@solana/rpc</code> and <code>@solana/rpc-subscriptions</code>.</li>
<li><code>@solana/rpc-types</code>: Shared Solana RPC types and helpers that are used by both <code>@solana/rpc</code> and <code>@solana/rpc-subscriptions</code>.</li>
</ul>
<p>Since the main <code>@solana/web3.js</code> library also re-exports the <code>@solana/rpc-subscriptions</code> package we will import RPC Subscriptions types and functions directly from the main library going forward.</p>
<a id="md:getting-started-with-rpc-subscriptions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Getting Started with RPC Subscriptions<a href="#md:getting-started-with-rpc-subscriptions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To get started with RPC Subscriptions, you may use the <code>createSolanaRpcSubscriptions</code> function by providing the WebSocket URL of a Solana JSON RPC server. This will create a default client for interacting with Solana RPC Subscriptions.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpcSubscriptions</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create an RPC Subscriptions client.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpcSubscriptions</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptions</span><span class="hl-1">(</span><span class="hl-2">&#39;ws://127.0.0.1:8900&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">//    ^? RpcSubscriptions&lt;SolanaRpcSubscriptionsApi&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="md:subscriptions-as-asynciterators" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Subscriptions as <code>AsyncIterators</code><a href="#md:subscriptions-as-asynciterators" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The new subscriptions API vends subscription notifications as an <code>AsyncIterator</code>. The <code>AsyncIterator</code> conforms to the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_async_iterator_and_async_iterable_protocols" target="_blank" class="external">async iterator protocol</a>, which allows developers to consume messages using a <code>for await...of</code> loop.</p>
<p>Here’s an example of working with a subscription in the new library:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">address</span><span class="hl-1">, </span><span class="hl-11">createSolanaRpcSubscriptions</span><span class="hl-1">, </span><span class="hl-11">createDefaultRpcSubscriptionsTransport</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create the RPC Subscriptions client.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpcSubscriptions</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptions</span><span class="hl-1">(</span><span class="hl-2">&#39;ws://127.0.0.1:8900&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Set up an abort controller.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">abortController</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">AbortController</span><span class="hl-1">();</span><br/><br/><span class="hl-4">// Subscribe to account notifications.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">accountNotifications</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpcSubscriptions</span><br/><span class="hl-1">    .</span><span class="hl-0">accountNotifications</span><span class="hl-1">(</span><span class="hl-0">address</span><span class="hl-1">(</span><span class="hl-2">&#39;AxZfZWeqztBCL37Mkjkd4b8Hf6J13WCcfozrBY6vZzv3&#39;</span><span class="hl-1">), { </span><span class="hl-11">commitment:</span><span class="hl-1"> </span><span class="hl-2">&#39;confirmed&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">    .</span><span class="hl-0">subscribe</span><span class="hl-1">({ </span><span class="hl-11">abortSignal:</span><span class="hl-1"> </span><span class="hl-11">abortController</span><span class="hl-1">.</span><span class="hl-11">signal</span><span class="hl-1"> });</span><br/><br/><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">// Consume messages.</span><br/><span class="hl-1">    </span><span class="hl-10">for</span><span class="hl-1"> </span><span class="hl-10">await</span><span class="hl-1"> (</span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">notification</span><span class="hl-1"> </span><span class="hl-3">of</span><span class="hl-1"> </span><span class="hl-11">accountNotifications</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-11">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;New balance&#39;</span><span class="hl-1">, </span><span class="hl-11">notification</span><span class="hl-1">.</span><span class="hl-11">value</span><span class="hl-1">.</span><span class="hl-11">lamports</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">} </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-11">e</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">// The subscription went down.</span><br/><span class="hl-1">    </span><span class="hl-4">// Retry it and then recover from potentially having missed</span><br/><span class="hl-1">    </span><span class="hl-4">// a balance update, here (eg. by making a `getBalance()` call).</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>You can read more about <code>AsyncIterator</code> at the following links:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncIterator" target="_blank" class="external">Mozilla Developer Docs: <code>AsyncIterator</code></a></li>
<li><a href="https://www.nodejsdesignpatterns.com/blog/javascript-async-iterators/" target="_blank" class="external">Luciano Mammino (Blog): JavaScript Async Iterators</a></li>
</ul>
<a id="md:aborting-rpc-subscriptions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Aborting RPC Subscriptions<a href="#md:aborting-rpc-subscriptions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Similarly to RPC calls, applications can terminate active subscriptions using an <code>AbortController</code> attribute on the <code>subscribe</code> method. In fact, this parameter is <em>required</em> for subscriptions to encourage you to clean up subscriptions that your application no longer needs.</p>
<p>Let's take a look at some concrete examples that demonstrate how to abort subscriptions.</p>
<a id="md:subscription-timeout" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Subscription Timeout<a href="#md:subscription-timeout" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Here's an example of an <code>AbortController</code> used to abort a subscription after a 5-second timeout:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpcSubscriptions</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpcSubscriptions</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptions</span><span class="hl-1">(</span><span class="hl-2">&#39;ws://127.0.0.1:8900&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Subscribe for slot notifications using an AbortSignal that times out after 5 seconds.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">slotNotifications</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpcSubscriptions</span><br/><span class="hl-1">    .</span><span class="hl-0">slotNotifications</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-0">subscribe</span><span class="hl-1">({ </span><span class="hl-11">abortSignal:</span><span class="hl-1"> </span><span class="hl-11">AbortSignal</span><span class="hl-1">.</span><span class="hl-0">timeout</span><span class="hl-1">(</span><span class="hl-13">5000</span><span class="hl-1">) });</span><br/><br/><span class="hl-4">// Log slot notifications.</span><br/><span class="hl-10">for</span><span class="hl-1"> </span><span class="hl-10">await</span><span class="hl-1"> (</span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">notification</span><span class="hl-1"> </span><span class="hl-3">of</span><span class="hl-1"> </span><span class="hl-11">slotNotifications</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-11">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Slot notification&#39;</span><span class="hl-1">, </span><span class="hl-11">notification</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-11">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Done.&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Read more about <code>AbortController</code> at the following links:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" target="_blank" class="external">Mozilla Developer Docs: <code>AbortController</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal" target="_blank" class="external">Mozilla Developer Docs: <code>AbortSignal</code></a></li>
<li><a href="https://javascript.info/fetch-abort" target="_blank" class="external">JavaScript.info: Fetch: Abort</a></li>
</ul>
<a id="md:cancelling-subscriptions" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Cancelling Subscriptions<a href="#md:cancelling-subscriptions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>It is also possible to abort a subscription inside the <code>for await...of</code> loop. This enables us to cancel a subscription based on some condition, such as a change in the state of an account. For instance, the following example cancels a subscription when the owner of an account changes:</p>
<pre><code class="ts"><span class="hl-4">// Subscribe to account notifications.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">accountNotifications</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpc</span><br/><span class="hl-1">    .</span><span class="hl-0">accountNotifications</span><span class="hl-1">(</span><span class="hl-0">address</span><span class="hl-1">(</span><span class="hl-2">&#39;AxZfZWeqztBCL37Mkjkd4b8Hf6J13WCcfozrBY6vZzv3&#39;</span><span class="hl-1">), { </span><span class="hl-11">commitment:</span><span class="hl-1"> </span><span class="hl-2">&#39;confirmed&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">    .</span><span class="hl-0">subscribe</span><span class="hl-1">({ </span><span class="hl-11">abortSignal</span><span class="hl-1"> });</span><br/><br/><span class="hl-4">// Consume messages.</span><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-11">previousOwner</span><span class="hl-1"> = </span><span class="hl-3">null</span><span class="hl-1">;</span><br/><span class="hl-10">for</span><span class="hl-1"> </span><span class="hl-10">await</span><span class="hl-1"> (</span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">notification</span><span class="hl-1"> </span><span class="hl-3">of</span><span class="hl-1"> </span><span class="hl-11">accountNotifications</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-11">value</span><span class="hl-1">: { </span><span class="hl-12">owner</span><span class="hl-1"> },</span><br/><span class="hl-1">    } = </span><span class="hl-11">notification</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">// Check the owner to see if it has changed</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-11">previousOwner</span><span class="hl-1"> &amp;&amp; </span><span class="hl-11">owner</span><span class="hl-1"> !== </span><span class="hl-11">previousOwner</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">// If so, abort the subscription</span><br/><span class="hl-1">        </span><span class="hl-11">abortController</span><span class="hl-1">.</span><span class="hl-0">abort</span><span class="hl-1">();</span><br/><span class="hl-1">    } </span><span class="hl-10">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-11">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-11">notification</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-11">previousOwner</span><span class="hl-1"> = </span><span class="hl-11">owner</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:failed-vs-aborted-subscriptions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Failed vs. Aborted Subscriptions<a href="#md:failed-vs-aborted-subscriptions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>It is important to note that a subscription failure behaves differently from a subscription abort. A subscription failure occurs when the subscription goes down and will throw an error that can be intercepted in a <code>try/catch</code>. However, an aborted subscription will not throw an error, but will instead exit the <code>for await...of</code> loop.</p>
<pre><code class="ts"><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">for</span><span class="hl-1"> </span><span class="hl-10">await</span><span class="hl-1"> (</span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">notification</span><span class="hl-1"> </span><span class="hl-3">of</span><span class="hl-1"> </span><span class="hl-11">notifications</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">// Consume messages.</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">// [ABORTED] Reaching this line means the subscription was aborted — i.e. unsubscribed.</span><br/><span class="hl-1">} </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-11">e</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">// [FAILED] Reaching this line means the subscription went down.</span><br/><span class="hl-1">    </span><span class="hl-4">// Retry it, then recover from potential missed messages.</span><br/><span class="hl-1">} </span><span class="hl-10">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">// [ABORTED or FAILED] Whether the subscription failed or was aborted, you can run cleanup code here.</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:message-gap-recovery" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Message Gap Recovery<a href="#md:message-gap-recovery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>One of the most crucial aspects of any subscription API is managing potential missed messages. Missing messages, such as account state updates, could be catastrophic for an application. That’s why the new library provides native support for recovering missed messages using the <code>AsyncIterator</code>.</p>
<p>When a connection fails unexpectedly, any messages you miss while disconnected can result in your UI falling behind or becoming corrupt. Because subscription failure is now made explicit in the new API, you can implement ‘catch-up’ logic after re-establishing the subscription.</p>
<p>Here’s an example of such logic:</p>
<pre><code class="ts"><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">for</span><span class="hl-1"> </span><span class="hl-10">await</span><span class="hl-1"> (</span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">notif</span><span class="hl-1"> </span><span class="hl-3">of</span><span class="hl-1"> </span><span class="hl-11">accountNotifications</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">updateAccountBalance</span><span class="hl-1">(</span><span class="hl-11">notif</span><span class="hl-1">.</span><span class="hl-11">lamports</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">} </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-11">e</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">// The subscription failed.</span><br/><span class="hl-1">    </span><span class="hl-4">// First, re-establish the subscription.</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">setupAccountBalanceSubscription</span><span class="hl-1">(</span><span class="hl-11">address</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">// Then make a one-shot request to &#39;catch up&#39; on any missed balance changes.</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-11">value</span><span class="hl-1">: </span><span class="hl-12">lamports</span><span class="hl-1"> } = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpc</span><span class="hl-1">.</span><span class="hl-0">getBalance</span><span class="hl-1">(</span><span class="hl-11">address</span><span class="hl-1">).</span><span class="hl-0">send</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">updateAccountBalance</span><span class="hl-1">(</span><span class="hl-11">lamports</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:using-custom-rpc-subscriptions-transports" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using Custom RPC Subscriptions Transports<a href="#md:using-custom-rpc-subscriptions-transports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>createSolanaRpcSubscriptions</code> function communicates with the RPC server using a default <code>WebSocket</code> channel that should satisfy most use cases. However, you may here as well provide your own channel creator or decorate existing ones to communicate with RPC servers in any way you see fit. In the example below, we supply a custom <code>WebSocket</code> channel creator and use it to create a new RPC Subscriptions client via the <code>createSolanaRpcSubscriptionsFromTransport</code> function.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createDefaultRpcSubscriptionsTransport</span><span class="hl-1">, </span><span class="hl-11">createSolanaRpcSubscriptionsFromTransport</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create a transport with a custom channel creator of your choice.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transport</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcSubscriptionsTransport</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">createChannel</span><span class="hl-1">({ </span><span class="hl-11">abortSignal</span><span class="hl-1"> }) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-0">createWebSocketChannel</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-11">maxSubscriptionsPerChannel:</span><span class="hl-1"> </span><span class="hl-13">100</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-11">minChannels:</span><span class="hl-1"> </span><span class="hl-13">25</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-11">sendBufferHighWatermark:</span><span class="hl-1"> </span><span class="hl-13">32_768</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-11">signal:</span><span class="hl-1"> </span><span class="hl-11">abortSignal</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;ws://127.0.0.1:8900&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// Create an RPC client using that transport.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpcSubscriptions</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptionsFromTransport</span><span class="hl-1">(</span><span class="hl-11">transport</span><span class="hl-1">);</span><br/><span class="hl-4">//    ^? RpcSubscriptions&lt;SolanaRpcSubscriptionsApi&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="md:augmentingconstraining-the-rpc-subscriptions-api" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Augmenting/Constraining the RPC Subscriptions API<a href="#md:augmentingconstraining-the-rpc-subscriptions-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Using the <code>createSolanaRpcSubscriptions</code> or <code>createSolanaRpcSubscriptionsFromTransport</code> functions, we always get the same RPC Subscriptions API, including all Solana RPC stable subscriptions. However, since the RPC Subscriptions API is described using types only, it is possible to constrain the API to a specific set of subscriptions or even add your own custom subscriptions.</p>
<a id="md:constraining-by-cluster-1" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Constraining by Cluster<a href="#md:constraining-by-cluster-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If you're using a specific cluster, you may wrap your RPC URL inside a helper function like <code>mainnet</code> or <code>devnet</code> to inject that information into the RPC type system.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpcSubscriptions</span><span class="hl-1">, </span><span class="hl-11">mainnet</span><span class="hl-1">, </span><span class="hl-11">devnet</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">mainnetRpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptions</span><span class="hl-1">(</span><span class="hl-0">mainnet</span><span class="hl-1">(</span><span class="hl-2">&#39;https://api.mainnet-beta.solana.com&#39;</span><span class="hl-1">));</span><br/><span class="hl-4">//    ^? RpcSubscriptionsMainnet&lt;SolanaRpcSubscriptionsApi&gt;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">devnetRpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptions</span><span class="hl-1">(</span><span class="hl-0">devnet</span><span class="hl-1">(</span><span class="hl-2">&#39;https://api.devnet.solana.com&#39;</span><span class="hl-1">));</span><br/><span class="hl-4">//    ^? RpcSubscriptionsDevnet&lt;SolanaRpcSubscriptionsApi&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="md:including-unstable-subscriptions" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Including Unstable Subscriptions<a href="#md:including-unstable-subscriptions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If your app needs access to <a href="https://docs.solana.com/api/websocket#blocksubscribe" target="_blank" class="external">unstable RPC Subscriptions</a> — e.g. <code>BlockNotificationsApi</code> or <code>SlotsUpdatesNotificationsApi</code> — and your RPC server supports them, you may use the <code>createSolanaRpcSubscriptions_UNSTABLE</code> and <code>createSolanaRpcSubscriptionsFromTransport_UNSTABLE</code> functions to create an RPC Subscriptions client that includes those subscriptions.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-11">createDefaultSolanaRpcSubscriptionsChannelCreator</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createDefaultRpcSubscriptionsTransport</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createSolanaRpcSubscriptions_UNSTABLE</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createSolanaRpcSubscriptionsFromTransport_UNSTABLE</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Using the default WebSocket channel.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpcSubscriptions</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptions_UNSTABLE</span><span class="hl-1">(</span><span class="hl-2">&#39;ws://127.0.0.1:8900&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">//    ^? RpcSubscriptions&lt;SolanaRpcSubscriptionsApi &amp; SolanaRpcSubscriptionsApiUnstable&gt;</span><br/><br/><span class="hl-4">// Using a custom transport.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transport</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcSubscriptionsTransport</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">createChannel:</span><span class="hl-1"> </span><span class="hl-0">createDefaultSolanaRpcSubscriptionsChannelCreator</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;ws://127.0.0.1:8900&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">});</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpcSubscriptions</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptionsFromTransport_UNSTABLE</span><span class="hl-1">(</span><span class="hl-11">transport</span><span class="hl-1">);</span><br/><span class="hl-4">//    ^? RpcSubscriptions&lt;SolanaRpcSubscriptionsApi &amp; SolanaRpcSubscriptionsApiUnstable&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="md:cherry-picking-api-methods-1" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Cherry-Picking API Methods<a href="#md:cherry-picking-api-methods-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>You may constrain the scope of the Subscription API even further so you are left only with the subscriptions you need. The simplest way to do this is to cast the created RPC client to a type that only includes the methods you need.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-11">createSolanaRpcSubscriptions</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">RpcSubscriptions</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">AccountNotificationsApi</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">SlotNotificationsApi</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptions</span><span class="hl-1">(</span><span class="hl-2">&#39;ws://127.0.0.1:8900&#39;</span><span class="hl-1">) </span><span class="hl-10">as</span><span class="hl-1"> </span><span class="hl-14">RpcSubscriptions</span><span class="hl-1">&lt;</span><br/><span class="hl-1">    </span><span class="hl-14">AccountNotificationsApi</span><span class="hl-1"> &amp; </span><span class="hl-14">SlotNotificationsApi</span><br/><span class="hl-1">&gt;;</span>
</code><button type="button">Copy</button></pre>

<p>Alternatively, you may explicitly create the RPC Subscriptions API using the <code>createSolanaRpcSubscriptionsApi</code> function. You will then need to create your own transport explicitly and bind the two together using the <code>createSubscriptionRpc</code> function.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-11">createDefaultSolanaRpcSubscriptionsChannelCreator</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createDefaultRpcSubscriptionsTransport</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createSubscriptionRpc</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createSolanaRpcSubscriptionsApi</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">DEFAULT_RPC_CONFIG</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">AccountNotificationsApi</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">type</span><span class="hl-1"> </span><span class="hl-11">SlotNotificationsApi</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">api</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpcSubscriptionsApi</span><span class="hl-1">&lt;</span><span class="hl-14">AccountNotificationsApi</span><span class="hl-1"> &amp; </span><span class="hl-14">SlotNotificationsApi</span><span class="hl-1">&gt;(</span><span class="hl-12">DEFAULT_RPC_CONFIG</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transport</span><span class="hl-1"> = </span><span class="hl-0">createDefaultRpcSubscriptionsTransport</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">createChannel:</span><span class="hl-1"> </span><span class="hl-0">createDefaultSolanaRpcSubscriptionsChannelCreator</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-11">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;ws://127.0.0.1:8900&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">});</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpcSubscriptions</span><span class="hl-1"> = </span><span class="hl-0">createSubscriptionRpc</span><span class="hl-1">({ </span><span class="hl-11">api</span><span class="hl-1">, </span><span class="hl-11">transport</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p>Note that the <code>createSolanaRpcSubscriptionsApi</code> function is a wrapper on top of the <code>createRpcSubscriptionsApi</code> function which adds some Solana-specific transformers such as setting a default commitment on all methods or throwing an error when an integer overflow is detected.</p>
<a id="md:keys" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Keys<a href="#md:keys" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The new library takes a brand-new approach to Solana key pairs and addresses, which will feel quite different from the classes <code>PublicKey</code> and <code>Keypair</code> from version 1.x.</p>
<a id="md:web-crypto-api" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Web Crypto API<a href="#md:web-crypto-api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All key operations now use the native Ed25519 implementation in JavaScript’s Web Crypto API.</p>
<p>The API itself is designed to be a more reliably secure way to manage highly sensitive secret key information, but <strong>developers should still use extreme caution when dealing with secret key bytes in their applications</strong>.</p>
<p>One thing to note is that many operations from Web Crypto – such as importing, generating, signing, and verifying are now <strong>asynchronous</strong>.</p>
<p>Here’s an example of generating a <code>CryptoKeyPair</code> using the Web Crypto API and signing a message:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">generateKeyPair</span><span class="hl-1">, </span><span class="hl-11">signBytes</span><span class="hl-1">, </span><span class="hl-11">verifySignature</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">keyPair</span><span class="hl-1">: </span><span class="hl-14">CryptoKeyPair</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">message</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Uint8Array</span><span class="hl-1">(</span><span class="hl-13">8</span><span class="hl-1">).</span><span class="hl-0">fill</span><span class="hl-1">(</span><span class="hl-13">0</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">signedMessage</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">signBytes</span><span class="hl-1">(</span><span class="hl-11">keyPair</span><span class="hl-1">.</span><span class="hl-11">privateKey</span><span class="hl-1">, </span><span class="hl-11">message</span><span class="hl-1">);</span><br/><span class="hl-4">//    ^? Signature</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">verified</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">verifySignature</span><span class="hl-1">(</span><span class="hl-11">keyPair</span><span class="hl-1">.</span><span class="hl-11">publicKey</span><span class="hl-1">, </span><span class="hl-11">signedMessage</span><span class="hl-1">, </span><span class="hl-11">message</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:web-crypto-polyfill" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Web Crypto Polyfill<a href="#md:web-crypto-polyfill" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Wherever Ed25519 is not supported, we offer a polyfill for Web Crypto’s Ed25519 API.</p>
<p>This polyfill can be found at <code>@solana/webcrypto-ed25519-polyfill</code> and mimics the functionality of the Web Crypto API for Ed25519 key pairs using the same userspace implementation we used in web3.js 1.x. It does not polyfill other algorithms.</p>
<p>Determine if your target runtime supports Ed25519, and install the polyfill if it does not:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">install</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/webcrypto-ed25519-polyfill&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">generateKeyPair</span><span class="hl-1">, </span><span class="hl-11">signBytes</span><span class="hl-1">, </span><span class="hl-11">verifySignature</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">install</span><span class="hl-1">();</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">keyPair</span><span class="hl-1">: </span><span class="hl-14">CryptoKeyPair</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-4">/* Remaining logic */</span>
</code><button type="button">Copy</button></pre>

<p>You can see where Ed25519 is currently supported in <a href="https://github.com/WICG/webcrypto-secure-curves/issues/20" target="_blank" class="external">this GitHub issue</a> on the Web Crypto repository. Consider sniffing the user-agent when deciding whether or not to deliver the polyfill to browsers.</p>
<p>Operations on <code>CryptoKey</code> objects using the Web Crypto API <em>or</em> the polyfill are mostly handled by the <code>@solana/keys</code> package.</p>
<a id="md:string-addresses" class="tsd-anchor"></a><h3 class="tsd-anchor-link">String Addresses<a href="#md:string-addresses" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All addresses are now JavaScript strings. They are represented by the opaque type <code>Address</code>, which describes exactly what a Solana address actually is.</p>
<p>Consequently, that means no more <code>PublicKey</code>.</p>
<p>Here’s what they look like in development:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">Address</span><span class="hl-1">, </span><span class="hl-11">address</span><span class="hl-1">, </span><span class="hl-11">getAddressFromPublicKey</span><span class="hl-1">, </span><span class="hl-11">generateKeyPair</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Coerce a string to an `Address`</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">myOtherAddress</span><span class="hl-1"> = </span><span class="hl-0">address</span><span class="hl-1">(</span><span class="hl-2">&#39;AxZfZWeqztBCL37Mkjkd4b8Hf6J13WCcfozrBY6vZzv3&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Typecast it instead</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">myAddress</span><span class="hl-1"> =</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;AxZfZWeqztBCL37Mkjkd4b8Hf6J13WCcfozrBY6vZzv3&#39;</span><span class="hl-1"> </span><span class="hl-10">as</span><span class="hl-1"> </span><span class="hl-14">Address</span><span class="hl-1">&lt;</span><span class="hl-2">&#39;AxZfZWeqztBCL37Mkjkd4b8Hf6J13WCcfozrBY6vZzv3&#39;</span><span class="hl-1">&gt;;</span><br/><br/><span class="hl-4">// From CryptoKey</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">keyPair</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">generateKeyPair</span><span class="hl-1">();</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">myPublicKeyAsAddress</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">getAddressFromPublicKey</span><span class="hl-1">(</span><span class="hl-11">keyPair</span><span class="hl-1">.</span><span class="hl-11">publicKey</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Some tooling for working with base58-encoded addresses can be found in the <code>@solana/addresses</code> package.</p>
<a id="md:transactions" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Transactions<a href="#md:transactions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:creating-transaction-messages" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Creating Transaction Messages<a href="#md:creating-transaction-messages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Like many other familiar aspects of the 1.0 library, transactions have received a makeover.</p>
<p>For starters, all transaction messages are now version-aware, so there’s no longer a need to juggle two different types (eg. <code>Transaction</code> vs. <code>VersionedTransaction</code>).</p>
<p>Address lookups are now completely described inside transaction message instructions, so you don’t have to materialize <code>addressTableLookups</code> anymore.</p>
<p>Here’s a simple example of creating a transaction message – notice how its type is refined at each step of the process:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-11">address</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createTransactionMessage</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">setTransactionMessageFeePayer</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">setTransactionMessageLifetimeUsingBlockhash</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">Blockhash</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">recentBlockhash</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-11">blockhash:</span><span class="hl-1"> </span><span class="hl-2">&#39;4uhcVJyU9pJkvQyS88uRDiswHXSCkY3zQawwpjk2NsNY&#39;</span><span class="hl-1"> </span><span class="hl-10">as</span><span class="hl-1"> </span><span class="hl-14">Blockhash</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">lastValidBlockHeight:</span><span class="hl-1"> </span><span class="hl-13">196055492</span><span class="hl-3">n</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">feePayer</span><span class="hl-1"> = </span><span class="hl-0">address</span><span class="hl-1">(</span><span class="hl-2">&#39;AxZfZWeqztBCL37Mkjkd4b8Hf6J13WCcfozrBY6vZzv3&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Create a new transaction message</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessage</span><span class="hl-1"> = </span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-13">0</span><span class="hl-1"> });</span><br/><span class="hl-4">//    ^? V0TransactionMessage</span><br/><br/><span class="hl-4">// Set the fee payer</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessageWithFeePayer</span><span class="hl-1"> = </span><span class="hl-0">setTransactionMessageFeePayer</span><span class="hl-1">(</span><span class="hl-11">feePayer</span><span class="hl-1">, </span><span class="hl-11">transactionMessage</span><span class="hl-1">);</span><br/><span class="hl-4">//    ^? V0TransactionMessage &amp; ITransactionMessageWithFeePayer</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessageWithFeePayerAndLifetime</span><span class="hl-1"> = </span><span class="hl-0">setTransactionMessageLifetimeUsingBlockhash</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">// ^? V0TransactionMessage &amp; ITransactionMessageWithFeePayer &amp; TransactionMessageWithBlockhashLifetime</span><br/><span class="hl-1">    </span><span class="hl-11">recentBlockhash</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">transactionMessageWithFeePayer</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>As you can see, each time a transaction message is modified, the type reflects its new shape. If you add a fee payer, you’ll get a type representing a transaction message with a fee payer, and so on.</p>
<p>Transaction message objects are also <strong>frozen by these functions</strong> to prevent them from being mutated in place.</p>
<a id="md:signing-transaction-messages" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Signing Transaction Messages<a href="#md:signing-transaction-messages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>signTransaction(..)</code> function will raise a type error if your transaction message is not already equipped with a fee payer and a lifetime. This helps you catch errors at author-time instead of runtime.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">feePayer</span><span class="hl-1"> = </span><span class="hl-0">address</span><span class="hl-1">(</span><span class="hl-2">&#39;AxZfZWeqztBCL37Mkjkd4b8Hf6J13WCcfozrBY6vZzv3&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">signer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">generateKeyPair</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessage</span><span class="hl-1"> = </span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-2">&#39;legacy&#39;</span><span class="hl-1"> });</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessageWithFeePayer</span><span class="hl-1"> = </span><span class="hl-0">setTransactionMessageFeePayer</span><span class="hl-1">(</span><span class="hl-11">feePayer</span><span class="hl-1">, </span><span class="hl-11">transactionMessage</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Attempting to sign the transaction message without a lifetime will throw a type error</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">signedTransaction</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">signTransaction</span><span class="hl-1">([</span><span class="hl-11">signer</span><span class="hl-1">], </span><span class="hl-11">transactionMessageWithFeePayer</span><span class="hl-1">);</span><br/><span class="hl-4">// =&gt; &quot;Property &#39;lifetimeConstraint&#39; is missing in type&quot;</span>
</code><button type="button">Copy</button></pre>

<a id="md:calibrating-a-transaction-messages-compute-unit-budget" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Calibrating a Transaction Message's Compute Unit Budget<a href="#md:calibrating-a-transaction-messages-compute-unit-budget" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Correctly budgeting a compute unit limit for your transaction message can increase the probability that your transaction will be accepted for processing. If you don't declare a compute unit limit on your transaction, validators will assume an upper limit of 200K compute units (CU) per instruction.</p>
<p>Since validators have an incentive to pack as many transactions into each block as possible, they may choose to include transactions that they know will fit into the remaining compute budget for the current block over transactions that might not. For this reason, you should set a compute unit limit on each of your transaction messages, whenever possible.</p>
<p>Use this utility to estimate the actual compute unit cost of a given transaction message.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getSetComputeUnitLimitInstruction</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana-program/compute-budget&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">createSolanaRpc</span><span class="hl-1">, </span><span class="hl-11">getComputeUnitEstimateForTransactionMessageFactory</span><span class="hl-1">, </span><span class="hl-11">pipe</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Create an estimator function.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpc</span><span class="hl-1">(</span><span class="hl-2">&#39;http://127.0.0.1:8899&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">getComputeUnitEstimateForTransactionMessage</span><span class="hl-1"> = </span><span class="hl-0">getComputeUnitEstimateForTransactionMessageFactory</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">rpc</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// Create your transaction message.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessage</span><span class="hl-1"> = </span><span class="hl-0">pipe</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-2">&#39;legacy&#39;</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-4">/* ... */</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-4">// Request an estimate of the actual compute units this message will consume.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">computeUnitsEstimate</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">getComputeUnitEstimateForTransactionMessage</span><span class="hl-1">(</span><span class="hl-11">transactionMessage</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Set the transaction message&#39;s compute unit budget.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessageWithComputeUnitLimit</span><span class="hl-1"> = </span><span class="hl-0">prependTransactionMessageInstruction</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-0">getSetComputeUnitLimitInstruction</span><span class="hl-1">({ </span><span class="hl-11">units:</span><span class="hl-1"> </span><span class="hl-11">computeUnitsEstimate</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-11">transactionMessage</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<blockquote>
<p>[!WARNING]
The compute unit estimate is just that – an estimate. The compute unit consumption of the actual transaction might be higher or lower than what was observed in simulation. Unless you are confident that your particular transaction message will consume the same or fewer compute units as was estimated, you might like to augment the estimate by either a fixed number of CUs or a multiplier.</p>
</blockquote>
<blockquote>
<p>[!NOTE]
If you are preparing an <em>unsigned</em> transaction, destined to be signed and submitted to the network by a wallet, you might like to leave it up to the wallet to determine the compute unit limit. Consider that the wallet might have a more global view of how many compute units certain types of transactions consume, and might be able to make better estimates of an appropriate compute unit budget.</p>
</blockquote>
<a id="md:helpers-for-building-transaction-messages" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Helpers For Building Transaction Messages<a href="#md:helpers-for-building-transaction-messages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Building transaction messages in this manner might feel different from what you’re used to. Also, we certainly wouldn’t want you to have to bind transformed transaction messages to a new variable at each step, so we have released a functional programming library dubbed <code>@solana/functional</code> that lets you build transaction messages in <strong>pipelines</strong>. Here’s how it can be used:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">pipe</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/functional&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-11">address</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">createTransactionMessage</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">setTransactionMessageFeePayer</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">setTransactionMessageLifetimeUsingBlockhash</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">Blockhash</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Use `pipe(..)` to create a pipeline of transaction message transformation operations</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessage</span><span class="hl-1"> = </span><span class="hl-0">pipe</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-13">0</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">setTransactionMessageFeePayer</span><span class="hl-1">(</span><span class="hl-11">feePayer</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">setTransactionMessageLifetimeUsingBlockhash</span><span class="hl-1">(</span><span class="hl-11">recentBlockhash</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">),</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Note that <code>pipe(..)</code> is general-purpose, so it can be used to pipeline any functional transforms.</p>
<a id="md:codecs" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Codecs<a href="#md:codecs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We have taken steps to make it easier to write data (de)serializers, especially as they pertain to Rust datatypes and byte buffers.</p>
<p>Solana’s codecs libraries are broken up into modular components so you only need to import the ones you need. They are:</p>
<ul>
<li><code>@solana/codecs-core</code>: The core codecs library for working with codecs serializers and creating custom ones</li>
<li><code>@solana/codecs-numbers</code>: Used for serialization of numbers (little-endian and big-endian bytes, etc.)</li>
<li><code>@solana/codecs-strings</code>: Used for serialization of strings</li>
<li><code>@solana/codecs-data-structures</code>: Codecs and serializers for structs</li>
<li><code>@solana/options</code>: Designed to build codecs and serializers for types that mimic Rust’s enums, which can include embedded data within their variants such as values, tuples, and structs</li>
</ul>
<p>These packages are included in the main <code>@solana/web3.js</code> library but you may also import them from <code>@solana/codecs</code> if you only need the codecs.</p>
<p>Here’s an example of encoding and decoding a custom struct with some strings and numbers:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">addCodecSizePrefix</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/codecs-core&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getStructCodec</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/codecs-data-structures&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getU32Codec</span><span class="hl-1">, </span><span class="hl-11">getU64Codec</span><span class="hl-1">, </span><span class="hl-11">getU8Codec</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/codecs-numbers&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getUtf8Codec</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/codecs-strings&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// Equivalent in Rust:</span><br/><span class="hl-4">// struct {</span><br/><span class="hl-4">//     amount: u64,</span><br/><span class="hl-4">//     decimals: u8,</span><br/><span class="hl-4">//     name: String,</span><br/><span class="hl-4">// }</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">structCodec</span><span class="hl-1"> = </span><span class="hl-0">getStructCodec</span><span class="hl-1">([</span><br/><span class="hl-1">    [</span><span class="hl-2">&#39;amount&#39;</span><span class="hl-1">, </span><span class="hl-0">getU64Codec</span><span class="hl-1">()],</span><br/><span class="hl-1">    [</span><span class="hl-2">&#39;decimals&#39;</span><span class="hl-1">, </span><span class="hl-0">getU8Codec</span><span class="hl-1">()],</span><br/><span class="hl-1">    [</span><span class="hl-2">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-0">addCodecSizePrefix</span><span class="hl-1">(</span><span class="hl-0">getUtf8Codec</span><span class="hl-1">(), </span><span class="hl-0">getU32Codec</span><span class="hl-1">())],</span><br/><span class="hl-1">]);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">myToken</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-11">amount:</span><span class="hl-1"> </span><span class="hl-13">1000000000000000</span><span class="hl-3">n</span><span class="hl-1">, </span><span class="hl-4">// `bigint` or `number` is supported</span><br/><span class="hl-1">    </span><span class="hl-11">decimals:</span><span class="hl-1"> </span><span class="hl-13">2</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;My Token&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">myEncodedToken</span><span class="hl-1">: </span><span class="hl-14">Uint8Array</span><span class="hl-1"> = </span><span class="hl-11">structCodec</span><span class="hl-1">.</span><span class="hl-0">encode</span><span class="hl-1">(</span><span class="hl-11">myToken</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">myDecodedToken</span><span class="hl-1"> = </span><span class="hl-11">structCodec</span><span class="hl-1">.</span><span class="hl-0">decode</span><span class="hl-1">(</span><span class="hl-11">myEncodedToken</span><span class="hl-1">);</span><br/><br/><span class="hl-11">myDecodedToken</span><span class="hl-1"> </span><span class="hl-10">satisfies</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-11">amount</span><span class="hl-1">: </span><span class="hl-14">bigint</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-11">decimals</span><span class="hl-1">: </span><span class="hl-14">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-11">name</span><span class="hl-1">: </span><span class="hl-14">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>You may only need to encode or decode data, but not both. Importing one or the other allows your optimizing compiler to tree-shake the other implementation away:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">Codec</span><span class="hl-1">, </span><span class="hl-11">combineCodec</span><span class="hl-1">, </span><span class="hl-11">Decoder</span><span class="hl-1">, </span><span class="hl-11">Encoder</span><span class="hl-1">, </span><span class="hl-11">addDecoderSizePrefix</span><span class="hl-1">, </span><span class="hl-11">addEncoderSizePrefix</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/codecs-core&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getStructDecoder</span><span class="hl-1">, </span><span class="hl-11">getStructEncoder</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/codecs-data-structures&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-11">getU8Decoder</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">getU8Encoder</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">getU32Decoder</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">getU32Encoder</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">getU64Decoder</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">getU64Encoder</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/codecs-numbers&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getUtf8Decoder</span><span class="hl-1">, </span><span class="hl-11">getUtf8Encoder</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/codecs-strings&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-14">MyToken</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-11">amount</span><span class="hl-1">: </span><span class="hl-14">bigint</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-11">decimals</span><span class="hl-1">: </span><span class="hl-14">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-11">name</span><span class="hl-1">: </span><span class="hl-14">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-14">MyTokenArgs</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-11">amount</span><span class="hl-1">: </span><span class="hl-14">number</span><span class="hl-1"> | </span><span class="hl-14">bigint</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-11">decimals</span><span class="hl-1">: </span><span class="hl-14">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-11">name</span><span class="hl-1">: </span><span class="hl-14">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">getMyTokenEncoder</span><span class="hl-1"> = (): </span><span class="hl-14">Encoder</span><span class="hl-1">&lt;</span><span class="hl-14">MyTokenArgs</span><span class="hl-1">&gt; </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-0">getStructEncoder</span><span class="hl-1">([</span><br/><span class="hl-1">        [</span><span class="hl-2">&#39;amount&#39;</span><span class="hl-1">, </span><span class="hl-0">getU64Encoder</span><span class="hl-1">()],</span><br/><span class="hl-1">        [</span><span class="hl-2">&#39;decimals&#39;</span><span class="hl-1">, </span><span class="hl-0">getU8Encoder</span><span class="hl-1">()],</span><br/><span class="hl-1">        [</span><span class="hl-2">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-0">addEncoderSizePrefix</span><span class="hl-1">(</span><span class="hl-0">getUtf8Encoder</span><span class="hl-1">(), </span><span class="hl-0">getU32Encoder</span><span class="hl-1">())],</span><br/><span class="hl-1">    ]);</span><br/><br/><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">getMyTokenDecoder</span><span class="hl-1"> = (): </span><span class="hl-14">Decoder</span><span class="hl-1">&lt;</span><span class="hl-14">MyToken</span><span class="hl-1">&gt; </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-0">getStructDecoder</span><span class="hl-1">([</span><br/><span class="hl-1">        [</span><span class="hl-2">&#39;amount&#39;</span><span class="hl-1">, </span><span class="hl-0">getU64Decoder</span><span class="hl-1">()],</span><br/><span class="hl-1">        [</span><span class="hl-2">&#39;decimals&#39;</span><span class="hl-1">, </span><span class="hl-0">getU8Decoder</span><span class="hl-1">()],</span><br/><span class="hl-1">        [</span><span class="hl-2">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-0">addDecoderSizePrefix</span><span class="hl-1">(</span><span class="hl-0">getUtf8Decoder</span><span class="hl-1">(), </span><span class="hl-0">getU32Decoder</span><span class="hl-1">())],</span><br/><span class="hl-1">    ]);</span><br/><br/><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">getMyTokenCodec</span><span class="hl-1"> = (): </span><span class="hl-14">Codec</span><span class="hl-1">&lt;</span><span class="hl-14">MyTokenArgs</span><span class="hl-1">, </span><span class="hl-14">MyToken</span><span class="hl-1">&gt; </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-0">combineCodec</span><span class="hl-1">(</span><span class="hl-0">getMyTokenEncoder</span><span class="hl-1">(), </span><span class="hl-0">getMyTokenDecoder</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<p>You can read me about codecs in <a href="https://github.com/solana-labs/solana-web3.js/blob/master/packages/codecs/README.md" target="_blank" class="external">the official Codec documentation</a>.</p>
<a id="md:type-safety" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Type-Safety<a href="#md:type-safety" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The new library makes use of some advanced TypeScript features, including generic types, conditional types, <code>Parameters&lt;..&gt;</code>, <code>ReturnType&lt;..&gt;</code> and more.</p>
<p>We’ve described the RPC API in detail so that TypeScript can determine the <em>exact</em> type of the result you will receive from the server given a particular input. Change the type of the input, and you will see the return type reflect that change.</p>
<a id="md:rpc-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">RPC Types<a href="#md:rpc-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The RPC methods – both HTTP and subscriptions – are built with multiple overloads and conditional types. The expected HTTP response payload or subscription message format will be reflected in the return type of the function you’re working with when you provide the inputs in your code.</p>
<p>Here’s an example of this in action:</p>
<pre><code class="ts"><span class="hl-4">// Provide one set of parameters, get a certain type</span><br/><span class="hl-4">// These parameters resolve to return type:</span><br/><span class="hl-4">// {</span><br/><span class="hl-4">//     blockhash: Blockhash;</span><br/><span class="hl-4">//     blockHeight: bigint;</span><br/><span class="hl-4">//     blockTime: UnixTimestamp;</span><br/><span class="hl-4">//     parentSlot: bigint;</span><br/><span class="hl-4">//     previousBlockhash: Blockhash;</span><br/><span class="hl-4">// }</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">blockResponse</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpc</span><br/><span class="hl-1">    .</span><span class="hl-0">getBlock</span><span class="hl-1">(</span><span class="hl-13">0</span><span class="hl-3">n</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-11">rewards:</span><span class="hl-1"> </span><span class="hl-3">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-11">transactionDetails:</span><span class="hl-1"> </span><span class="hl-2">&#39;none&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-0">send</span><span class="hl-1">();</span><br/><br/><span class="hl-4">// Switch `rewards` to `true`, get `rewards` in the return type</span><br/><span class="hl-4">// {</span><br/><span class="hl-4">//     /* ... Previous response */</span><br/><span class="hl-4">//     rewards: Reward[];</span><br/><span class="hl-4">// }</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">blockWithRewardsResponse</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpc</span><br/><span class="hl-1">    .</span><span class="hl-0">getBlock</span><span class="hl-1">(</span><span class="hl-13">0</span><span class="hl-3">n</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-11">rewards:</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-11">transactionDetails:</span><span class="hl-1"> </span><span class="hl-2">&#39;none&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-0">send</span><span class="hl-1">();</span><br/><br/><span class="hl-4">// Switch `transactionDetails` to `full`, get `transactions` in the return type</span><br/><span class="hl-4">// {</span><br/><span class="hl-4">//     /* ... Previous response */</span><br/><span class="hl-4">//     transactions: TransactionResponse[];</span><br/><span class="hl-4">// }</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">blockWithRewardsAndTransactionsResponse</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpc</span><br/><span class="hl-1">    .</span><span class="hl-0">getBlock</span><span class="hl-1">(</span><span class="hl-13">0</span><span class="hl-3">n</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-11">rewards:</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-11">transactionDetails:</span><span class="hl-1"> </span><span class="hl-2">&#39;full&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-0">send</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:catching-compile-time-bugs-with-typescript" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Catching Compile-Time Bugs with TypeScript<a href="#md:catching-compile-time-bugs-with-typescript" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>As previously mentioned, the type coverage in version 2.0 allows developers to catch common bugs at compile time, rather than runtime.</p>
<p>In the example below, a transaction message is created and then attempted to be signed without setting the fee payer. This would result in a runtime error from the RPC, but instead you will see a type error from TypeScript as you type:</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessage</span><span class="hl-1"> = </span><span class="hl-0">pipe</span><span class="hl-1">(</span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-13">0</span><span class="hl-1"> }), </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-0">setTransactionMessageLifetimeUsingBlockhash</span><span class="hl-1">(</span><span class="hl-11">recentBlockhash</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">),</span><br/><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">signedTransaction</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">signTransaction</span><span class="hl-1">([</span><span class="hl-11">keyPair</span><span class="hl-1">], </span><span class="hl-11">transactionMessage</span><span class="hl-1">); </span><span class="hl-4">// ERROR: Property &#39;feePayer&#39; is missing in type</span>
</code><button type="button">Copy</button></pre>

<p>Consider another example where a developer is attempting to send a transaction that has not been fully signed. Again, the TypeScript compiler will throw a type error:</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessage</span><span class="hl-1"> = </span><span class="hl-0">pipe</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-13">0</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">setTransactionMessageFeePayer</span><span class="hl-1">(</span><span class="hl-11">feePayerAddress</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">setTransactionMessageLifetimeUsingBlockhash</span><span class="hl-1">(</span><span class="hl-11">recentBlockhash</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">),</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">signedTransaction</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">signTransaction</span><span class="hl-1">([], </span><span class="hl-11">transactionMessage</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// Asserts the transaction is a `FullySignedTransaction`</span><br/><span class="hl-4">// Throws an error if any signatures are missing!</span><br/><span class="hl-0">assertTransactionIsFullySigned</span><span class="hl-1">(</span><span class="hl-11">signedTransaction</span><span class="hl-1">);</span><br/><br/><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">sendAndConfirmTransaction</span><span class="hl-1">(</span><span class="hl-11">signedTransaction</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Are you building a nonce transaction and forgot to make <code>AdvanceNonce</code> the first instruction? That’s a type error:</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">feePayer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">generateKeyPair</span><span class="hl-1">();</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">feePayerAddress</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">getAddressFromPublicKey</span><span class="hl-1">(</span><span class="hl-11">feePayer</span><span class="hl-1">.</span><span class="hl-11">publicKey</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">notNonceTransactionMessage</span><span class="hl-1"> = </span><span class="hl-0">pipe</span><span class="hl-1">(</span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-13">0</span><span class="hl-1"> }), </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-0">setTransactionMessageFeePayer</span><span class="hl-1">(</span><span class="hl-11">feePayerAddress</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">),</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-11">notNonceTransactionMessage</span><span class="hl-1"> </span><span class="hl-10">satisfies</span><span class="hl-1"> </span><span class="hl-14">TransactionMessageWithDurableNonceLifetime</span><span class="hl-1">;</span><br/><span class="hl-4">// =&gt; Property &#39;lifetimeConstraint&#39; is missing in type</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">nonceConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-11">nonce:</span><span class="hl-1"> </span><span class="hl-2">&#39;nonce&#39;</span><span class="hl-1"> </span><span class="hl-10">as</span><span class="hl-1"> </span><span class="hl-14">Nonce</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">nonceAccountAddress:</span><span class="hl-1"> </span><span class="hl-0">address</span><span class="hl-1">(</span><span class="hl-2">&#39;5tLU66bxQ35so2bReGcyf3GfMMAAauZdNA1N4uRnKQu4&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-11">nonceAuthorityAddress:</span><span class="hl-1"> </span><span class="hl-0">address</span><span class="hl-1">(</span><span class="hl-2">&#39;GDhj8paPg8woUzp9n8fj7eAMocN5P7Ej3A7T9F5gotTX&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">stillNotNonceTransactionMessage</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-11">lifetimeConstraint:</span><span class="hl-1"> </span><span class="hl-11">nonceConfig</span><span class="hl-1">,</span><br/><span class="hl-1">    ...</span><span class="hl-11">notNonceTransactionMessage</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-11">stillNotNonceTransactionMessage</span><span class="hl-1"> </span><span class="hl-10">satisfies</span><span class="hl-1"> </span><span class="hl-14">TransactionMessageWithDurableNonceLifetime</span><span class="hl-1">;</span><br/><span class="hl-4">// =&gt; &#39;readonly IInstruction&lt;string&gt;[]&#39; is not assignable to type &#39;readonly [AdvanceNonceAccountInstruction&lt;string, string&gt;, ...IInstruction&lt;string&gt;[]]&#39;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">validNonceTransactionMessage</span><span class="hl-1"> = </span><span class="hl-0">pipe</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-13">0</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">setTransactionMessageFeePayer</span><span class="hl-1">(</span><span class="hl-11">feePayerAddress</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">setTransactionMessageLifetimeUsingDurableNonce</span><span class="hl-1">(</span><span class="hl-11">nonceConfig</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">), </span><span class="hl-4">// Adds the instruction!</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-11">validNonceTransactionMessage</span><span class="hl-1"> </span><span class="hl-10">satisfies</span><span class="hl-1"> </span><span class="hl-14">TransactionMessageWithDurableNonceLifetime</span><span class="hl-1">; </span><span class="hl-4">// OK</span>
</code><button type="button">Copy</button></pre>

<p>The library’s type-checking can even catch you using lamports instead of SOL for a value:</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">airdropAmount</span><span class="hl-1"> = </span><span class="hl-13">1</span><span class="hl-3">n</span><span class="hl-1">; </span><span class="hl-4">// SOL</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">signature</span><span class="hl-1"> = </span><span class="hl-11">rpc</span><span class="hl-1">.</span><span class="hl-0">requestAirdrop</span><span class="hl-1">(</span><span class="hl-11">myAddress</span><span class="hl-1">, </span><span class="hl-11">airdropAmount</span><span class="hl-1">).</span><span class="hl-0">send</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>It will force you to cast the numerical value for your airdrop (or transfer, etc.) amount using <code>lamports()</code>, which should be a good reminder!</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">airdropAmount</span><span class="hl-1"> = </span><span class="hl-0">lamports</span><span class="hl-1">(</span><span class="hl-13">1000000000</span><span class="hl-3">n</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">signature</span><span class="hl-1"> = </span><span class="hl-11">rpc</span><span class="hl-1">.</span><span class="hl-0">requestAirdrop</span><span class="hl-1">(</span><span class="hl-11">myAddress</span><span class="hl-1">, </span><span class="hl-11">airdropAmount</span><span class="hl-1">).</span><span class="hl-0">send</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:compatibility-layer" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Compatibility Layer<a href="#md:compatibility-layer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You will have noticed by now that web3.js is a complete and total breaking change from the 1.x line. We want to provide you with a strategy for interacting with 1.x APIs while building your application using 2.0. You need a tool for commuting between 1.x and 2.0 data types.</p>
<p>The <code>@solana/compat</code> library allows for interoperability between functions and class objects from the legacy library - such as <code>VersionedTransaction</code>, <code>PublicKey</code>, and <code>Keypair</code> - and functions and types of the new library - such as <code>Address</code>, <code>Transaction</code>, and <code>CryptoKeyPair</code>.</p>
<p>Here’s how you can use <code>@solana/compat</code> to convert from a legacy <code>PublicKey</code> to an <code>Address</code>:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">fromLegacyPublicKey</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/compat&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">publicKey</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">PublicKey</span><span class="hl-1">(</span><span class="hl-2">&#39;B3piXWBQLLRuk56XG5VihxR4oe2PSsDM8nTF6s1DeVF5&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">address</span><span class="hl-1">: </span><span class="hl-14">Address</span><span class="hl-1"> = </span><span class="hl-0">fromLegacyPublicKey</span><span class="hl-1">(</span><span class="hl-11">publicKey</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Here’s how to convert from a legacy <code>Keypair</code> to a <code>CryptoKeyPair</code>:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">fromLegacyKeypair</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/compat&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">keypairLegacy</span><span class="hl-1"> = </span><span class="hl-11">Keypair</span><span class="hl-1">.</span><span class="hl-0">generate</span><span class="hl-1">();</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">cryptoKeyPair</span><span class="hl-1">: </span><span class="hl-14">CryptoKeyPair</span><span class="hl-1"> = </span><span class="hl-0">fromLegacyKeypair</span><span class="hl-1">(</span><span class="hl-11">keypair</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Here’s how to convert legacy transaction objects to the new library’s transaction types:</p>
<pre><code class="ts"><span class="hl-4">// Note that you can only convert `VersionedTransaction` objects</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">modernTransaction</span><span class="hl-1"> = </span><span class="hl-0">fromVersionedTransaction</span><span class="hl-1">(</span><span class="hl-11">classicTransaction</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>To see more conversions supported by <code>@solana/compat</code>, you can check out the package’s <a href="https://github.com/solana-labs/solana-web3.js/blob/master/packages/compat/README.md" target="_blank" class="external">README on GitHub</a>.</p>
<a id="md:program-clients" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Program Clients<a href="#md:program-clients" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Writing JavaScript clients for on-chain programs has been done manually up until now. Without an IDL for some of the native programs, this process has been necessarily manual and has resulted in clients that lag behind the actual capabilities of the programs themselves.</p>
<p>We think that program clients should be <em>generated</em> rather than written. Developers should be able to write Rust programs, compile the program code, and generate all of the JavaScript client-side code to interact with the program.</p>
<p>We use <a href="https://github.com/codama-idl/codama" target="_blank" class="external">Codama</a> to represent Solana programs and generate clients for them. This includes a JavaScript client compatible with this library. For instance, here is how you’d construct a transaction message composed of instructions from three different core programs.</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">appendTransactionMessageInstructions</span><span class="hl-1">, </span><span class="hl-11">createTransactionMessage</span><span class="hl-1">, </span><span class="hl-11">pipe</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana/web3.js&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getAddMemoInstruction</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana-program/memo&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getSetComputeUnitLimitInstruction</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana-program/compute-budget&#39;</span><span class="hl-1">;</span><br/><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-11">getTransferSolInstruction</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@solana-program/system&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">instructions</span><span class="hl-1"> = [</span><br/><span class="hl-1">    </span><span class="hl-0">getSetComputeUnitLimitInstruction</span><span class="hl-1">({ </span><span class="hl-11">units:</span><span class="hl-1"> </span><span class="hl-13">600_000</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-0">getTransferSolInstruction</span><span class="hl-1">({ </span><span class="hl-11">source</span><span class="hl-1">, </span><span class="hl-11">destination</span><span class="hl-1">, </span><span class="hl-11">amount:</span><span class="hl-1"> </span><span class="hl-13">1_000_000_000</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-0">getAddMemoInstruction</span><span class="hl-1">({ </span><span class="hl-11">memo:</span><span class="hl-1"> </span><span class="hl-2">&quot;I&#39;m transferring some SOL!&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">];</span><br/><br/><span class="hl-4">// Creates a V0 transaction message with 3 instructions inside.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">transactionMessage</span><span class="hl-1"> = </span><span class="hl-0">pipe</span><span class="hl-1">(</span><span class="hl-0">createTransactionMessage</span><span class="hl-1">({ </span><span class="hl-11">version:</span><span class="hl-1"> </span><span class="hl-13">0</span><span class="hl-1"> }), </span><span class="hl-11">tx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-0">appendTransactionMessageInstructions</span><span class="hl-1">(</span><span class="hl-11">instructions</span><span class="hl-1">, </span><span class="hl-11">tx</span><span class="hl-1">),</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>As you can see, each program now generates its own library allowing you to cherry-pick your dependencies.</p>
<p>Note that asynchronous versions may be available for some instructions which allows them to resolve more inputs on your behalf — such as PDA derivation. For instance, the <code>CreateLookupTable</code> instruction offers an asynchronous builder that derives the <code>address</code> account and the <code>bump</code> argument for us.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">rpc</span><span class="hl-1"> = </span><span class="hl-0">createSolanaRpc</span><span class="hl-1">(</span><span class="hl-2">&#39;http://127.0.0.1:8899&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> [</span><span class="hl-12">authority</span><span class="hl-1">, </span><span class="hl-12">recentSlot</span><span class="hl-1">] = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-14">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">([</span><br/><span class="hl-1">    </span><span class="hl-0">generateKeyPairSigner</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-11">rpc</span><span class="hl-1">.</span><span class="hl-0">getSlot</span><span class="hl-1">({ </span><span class="hl-11">commitment:</span><span class="hl-1"> </span><span class="hl-2">&#39;finalized&#39;</span><span class="hl-1"> }).</span><span class="hl-0">send</span><span class="hl-1">(),</span><br/><span class="hl-1">]);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">instruction</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">getCreateLookupTableInstructionAsync</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">authority</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">recentSlot</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Alternatively, you may use the synchronous builder if you already have all the required inputs at hand.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> [</span><span class="hl-12">address</span><span class="hl-1">, </span><span class="hl-12">bump</span><span class="hl-1">] = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">findAddressLookupTablePda</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">authority:</span><span class="hl-1"> </span><span class="hl-11">authority</span><span class="hl-1">.</span><span class="hl-11">address</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">recentSlot</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">instruction</span><span class="hl-1"> = </span><span class="hl-0">getCreateLookupTableInstruction</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">address</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">authority</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">bump</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">recentSlot</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>On top of instruction builders, these clients offer a variety of utilities such as:</p>
<ul>
<li>Instruction codecs — e.g. <code>getTransferSolInstructionDataCodec</code>.</li>
<li>Account types — e.g. <code>AddressLookupTable</code>.</li>
<li>Account codecs — e.g. <code>getAddressLookupTableAccountDataCodec</code>.</li>
<li>Account helpers — e.g. <code>fetchAddressLookupTable</code>.</li>
<li>PDA helpers — e.g. <code>findAddressLookupTablePda</code>, <code>fetchAddressLookupTableFromSeeds</code>.</li>
<li>Defined types and their codecs — e.g. <code>NonceState</code>, <code>getNonceStateCodec</code>.</li>
<li>Program helpers — e.g. <code>SYSTEM_PROGRAM_ADDRESS</code>, <code>SystemAccount</code> enum, <code>SystemAccount</code> enum, <code>identifySystemInstruction</code>.</li>
<li>And much more!</li>
</ul>
<p>Here’s another example that fetches an <code>AddressLookupTable</code> PDA from its seeds.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">account</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">fetchAddressLookupTableFromSeeds</span><span class="hl-1">(</span><span class="hl-11">rpc</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-11">authority:</span><span class="hl-1"> </span><span class="hl-11">authority</span><span class="hl-1">.</span><span class="hl-11">address</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">recentSlot</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-11">account</span><span class="hl-1">.</span><span class="hl-11">address</span><span class="hl-1">; </span><span class="hl-4">// Address</span><br/><span class="hl-11">account</span><span class="hl-1">.</span><span class="hl-11">lamports</span><span class="hl-1">; </span><span class="hl-4">// Lamports</span><br/><span class="hl-11">account</span><span class="hl-1">.</span><span class="hl-11">data</span><span class="hl-1">.</span><span class="hl-11">addresses</span><span class="hl-1">; </span><span class="hl-4">// Address[]</span><br/><span class="hl-11">account</span><span class="hl-1">.</span><span class="hl-11">data</span><span class="hl-1">.</span><span class="hl-11">authority</span><span class="hl-1">; </span><span class="hl-4">// Some&lt;Address&gt;</span><br/><span class="hl-11">account</span><span class="hl-1">.</span><span class="hl-11">data</span><span class="hl-1">.</span><span class="hl-11">deactivationSlot</span><span class="hl-1">; </span><span class="hl-4">// Slot</span><br/><span class="hl-11">account</span><span class="hl-1">.</span><span class="hl-11">data</span><span class="hl-1">.</span><span class="hl-11">lastExtendedSlot</span><span class="hl-1">; </span><span class="hl-4">// Slot</span><br/><span class="hl-11">account</span><span class="hl-1">.</span><span class="hl-11">data</span><span class="hl-1">.</span><span class="hl-11">lastExtendedSlotStartIndex</span><span class="hl-1">; </span><span class="hl-4">// number</span>
</code><button type="button">Copy</button></pre>

<a id="md:how-does-this-work" class="tsd-anchor"></a><h3 class="tsd-anchor-link">How Does This Work?<a href="#md:how-does-this-work" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All of this code is 100% auto-generated by Codama from a tree of standardized nodes that represent our programs. It contains obvious nodes such as <code>AccountNode</code> but also more specified nodes such as <code>ConditionalValueNode</code> that allows us to resolve account or argument default values conditionally.</p>
<p>Codama allows us to hydrate our tree of nodes from IDLs which are typically generated by program frameworks such as <a href="https://github.com/coral-xyz/anchor" target="_blank" class="external">Anchor</a> or <a href="https://github.com/metaplex-foundation/shank" target="_blank" class="external">Shank</a>. Additionally, visitors can be used on our nodes to expand the knowledge of our programs since the IDL itself doesn’t yet contain that level of information. Finally, special visitors called ‘renderers’ visit our tree to generate clients such as this JavaScript client.</p>
<p>Currently, there is one other renderer that generates Rust clients but this is only the beginning. In the future, you can expect renderers for auto-generated Python clients, documentation, CLIs, etc.</p>
<a id="md:create-solana-program" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Create Solana Program<a href="#md:create-solana-program" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We believe the whole ecosystem could benefit from generated program clients. That’s why we introduced a new NPM binary that allows you to create your Solana program — and generate clients for it — in no time. Simply run the following and follow the prompts to get started.</p>
<pre><code class="sh"><span class="hl-0">pnpm</span><span class="hl-1"> </span><span class="hl-2">create</span><span class="hl-1"> </span><span class="hl-2">solana-program</span>
</code><button type="button">Copy</button></pre>

<p>This <a href="https://github.com/solana-program/create-solana-program" target="_blank" class="external"><code>create-solana-program</code></a> installer will create a new repository including:</p>
<ul>
<li>An example program using the framework of your choice (Anchor coming soon).</li>
<li>Generated clients for any of the selected clients.</li>
<li>A set of scripts that allows you to:
<ul>
<li>Start a local validator including all programs and accounts you depend on.</li>
<li>Build, lint and test your programs.</li>
<li>Generate IDLs from your programs.</li>
<li>Generate clients from the generated IDLs.</li>
<li>Build and test each of your clients.</li>
</ul>
</li>
<li>GitHub Actions pipelines to test your program, test your clients, and even manually publish new packages or crates for your clients. (Coming soon).</li>
</ul>
<p>When selecting the JavaScript client, you will get a fully generated library compatible with the new web3.js much like the <code>@solana-program</code> packages showcased above.</p>
<a id="md:graphql" class="tsd-anchor"></a><h2 class="tsd-anchor-link">GraphQL<a href="#md:graphql" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Though not directly related to web3.js, we wanted to hijack your attention to show you something else that we’re working on, of particular interest to frontend developers. It’s a new API for interacting with the RPC: a GraphQL API.</p>
<p>The <code>@solana/rpc-graphql</code> package can be used to make GraphQL queries to Solana RPC endpoints, using the same transports described above (including any customizations).</p>
<p>Here’s an example of retrieving account data with GraphQL:</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">source</span><span class="hl-1"> = </span><span class="hl-2">`</span><br/><span class="hl-2">    query myQuery($address: String!) {</span><br/><span class="hl-2">        account(address: $address) {</span><br/><span class="hl-2">            dataBase58: data(encoding: BASE_58)</span><br/><span class="hl-2">            dataBase64: data(encoding: BASE_64)</span><br/><span class="hl-2">            lamports</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">`</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">variableValues</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-11">address:</span><span class="hl-1"> </span><span class="hl-2">&#39;AyGCwnwxQMCqaU4ixReHt8h5W4dwmxU7eM3BEQBdWVca&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">result</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpcGraphQL</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-11">source</span><span class="hl-1">, </span><span class="hl-11">variableValues</span><span class="hl-1">);</span><br/><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-11">result</span><span class="hl-1">).</span><span class="hl-0">toMatchObject</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-11">account:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-11">dataBase58:</span><span class="hl-1"> </span><span class="hl-2">&#39;2Uw1bpnsXxu3e&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-11">dataBase64:</span><span class="hl-1"> </span><span class="hl-2">&#39;dGVzdCBkYXRh&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-11">lamports:</span><span class="hl-1"> </span><span class="hl-13">10290815</span><span class="hl-3">n</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Using GraphQL allows developers to only specify which fields they <em>actually</em> need, and do away with the rest of the response.</p>
<p>However, GraphQL is also extremely powerful for <strong>nesting queries</strong>, which can be particularly useful if you want to, say, get the <strong>sum</strong> of every lamports balance of every <strong>owner of the owner</strong> of each token account, while discarding any mint accounts.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">source</span><span class="hl-1"> = </span><span class="hl-2">`</span><br/><span class="hl-2">    query getLamportsOfOwnersOfOwnersOfTokenAccounts {</span><br/><span class="hl-2">        programAccounts(programAddress: &quot;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&quot;) {</span><br/><span class="hl-2">            ... on TokenAccount {</span><br/><span class="hl-2">                owner {</span><br/><span class="hl-2">                    ownerProgram {</span><br/><span class="hl-2">                        lamports</span><br/><span class="hl-2">                    }</span><br/><span class="hl-2">                }</span><br/><span class="hl-2">            }</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">`</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">result</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpcGraphQL</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-11">source</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">sumOfAllLamportsOfOwnersOfOwnersOfTokenAccounts</span><span class="hl-1"> = </span><span class="hl-11">result</span><br/><span class="hl-1">    .</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-11">o</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-11">o</span><span class="hl-1">.</span><span class="hl-11">account</span><span class="hl-1">.</span><span class="hl-11">owner</span><span class="hl-1">.</span><span class="hl-11">ownerProgram</span><span class="hl-1">.</span><span class="hl-11">lamports</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-0">reduce</span><span class="hl-1">((</span><span class="hl-11">acc</span><span class="hl-1">, </span><span class="hl-11">lamports</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-11">acc</span><span class="hl-1"> + </span><span class="hl-11">lamports</span><span class="hl-1">, </span><span class="hl-13">0</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The new GraphQL package supports this same style of nested querying on transactions and blocks.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">source</span><span class="hl-1"> = </span><span class="hl-2">`</span><br/><span class="hl-2">    query myQuery($signature: String!, $commitment: Commitment) {</span><br/><span class="hl-2">        transaction(signature: $signature, commitment: $commitment) {</span><br/><span class="hl-2">            message {</span><br/><span class="hl-2">                instructions {</span><br/><span class="hl-2">                    ... on CreateAccountInstruction {</span><br/><span class="hl-2">                        lamports</span><br/><span class="hl-2">                        programId</span><br/><span class="hl-2">                        space</span><br/><span class="hl-2">                    }</span><br/><span class="hl-2">                }</span><br/><span class="hl-2">            }</span><br/><span class="hl-2">        }</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">`</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">variableValues</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-11">signature:</span><span class="hl-1"> </span><span class="hl-2">&#39;63zkpxATgAwXRGFQZPDESTw2m4uZQ99sX338ibgKtTcgG6v34E3MSS3zckCwJHrimS71cvei6h1Bn1K1De53BNWC&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">commitment:</span><span class="hl-1"> </span><span class="hl-2">&#39;confirmed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-12">result</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-11">rpcGraphQL</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-11">source</span><span class="hl-1">, </span><span class="hl-11">variableValues</span><span class="hl-1">);</span><br/><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-11">result</span><span class="hl-1">).</span><span class="hl-0">toMatchObject</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-11">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-11">transaction:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-11">message:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-11">instructions:</span><span class="hl-1"> </span><span class="hl-11">expect</span><span class="hl-1">.</span><span class="hl-0">arrayContaining</span><span class="hl-1">([</span><br/><span class="hl-1">                    {</span><br/><span class="hl-1">                        </span><span class="hl-11">lamports:</span><span class="hl-1"> </span><span class="hl-11">expect</span><span class="hl-1">.</span><span class="hl-0">any</span><span class="hl-1">(</span><span class="hl-11">BigInt</span><span class="hl-1">),</span><br/><span class="hl-1">                        </span><span class="hl-11">programId:</span><span class="hl-1"> </span><span class="hl-2">&#39;11111111111111111111111111111111&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                        </span><span class="hl-11">space:</span><span class="hl-1"> </span><span class="hl-11">expect</span><span class="hl-1">.</span><span class="hl-0">any</span><span class="hl-1">(</span><span class="hl-11">BigInt</span><span class="hl-1">),</span><br/><span class="hl-1">                    },</span><br/><span class="hl-1">                ]),</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>See more in the package’s <a href="https://github.com/solana-labs/solana-web3.js/tree/master/packages/rpc-graphql" target="_blank" class="external">README on GitHub</a>.</p>
<a id="md:development" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Development<a href="#md:development" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can see all development of this library and associated GraphQL tooling in the web3.js repository on GitHub.</p>
<ul>
<li><a href="https://github.com/solana-labs/solana-web3.js" target="_blank" class="external">https://github.com/solana-labs/solana-web3.js</a></li>
</ul>
<p>You can follow along with program client generator development in the <code>@solana-program</code> org and the <code>@codama-idl/codama</code> repository.</p>
<ul>
<li><a href="https://github.com/solana-program/" target="_blank" class="external">https://github.com/solana-program/</a></li>
<li><a href="https://github.com/codama-idl/codama" target="_blank" class="external">https://github.com/codama-idl/codama</a></li>
</ul>
<p>Solana Labs develops these tools in public, as open source. We encourage any and all developers who would like to work on these tools to contribute to the codebase.</p>
<a id="md:thank-you" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Thank you<a href="#md:thank-you" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We’re grateful that you have read this far. If you are interested in migrating an existing application to the new web3.js to take advantage of some of the benefits we’ve demonstrated, we want to give you some direct support. Reach out to <a href="https://t.me/steveluscher/" target="_blank" class="external">@steveluscher</a> on Telegram to start a conversation.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:solana-javascript-sdk"><span>Solana <wbr/>Java<wbr/>Script SDK</span></a><a href="#md:installation"><span>Installation</span></a><a href="#md:examples"><span>Examples</span></a><a href="#md:whats-new-in-version-20"><span>What&#39;s <wbr/>New in <wbr/>Version 2.0</span></a><ul><li><a href="#md:tree-shakability"><span>Tree-<wbr/>Shakability</span></a></li><li><a href="#md:composable-internals"><span>Composable <wbr/>Internals</span></a></li><li><a href="#md:modern-javascript-zero-dependency"><span>Modern <wbr/>Java<wbr/>Script; <wbr/>Zero-<wbr/>Dependency</span></a></li><li><a href="#md:functional-architecture"><span>Functional <wbr/>Architecture</span></a></li><li><a href="#md:statistics"><span>Statistics</span></a></li></ul><a href="#md:a-tour-of-the-version-20-api"><span>A <wbr/>Tour of the <wbr/>Version 2.0 API</span></a><ul><li><a href="#md:rpc"><span>RPC</span></a></li><li><ul><li><a href="#md:rpc-calls"><span>RPC <wbr/>Calls</span></a></li><li><a href="#md:custom-rpc-transports"><span>Custom RPC <wbr/>Transports</span></a></li><li><ul><li><a href="#md:round-robin"><span>Round <wbr/>Robin</span></a></li><li><a href="#md:sharding"><span>Sharding</span></a></li><li><a href="#md:retry"><span>Retry</span></a></li><li><a href="#md:failover"><span>Failover</span></a></li></ul></li><li><a href="#md:augmentingconstraining-the-rpc-api"><span>Augmenting/<wbr/>Constraining the RPC API</span></a></li><li><ul><li><a href="#md:constraining-by-cluster"><span>Constraining by <wbr/>Cluster</span></a></li><li><a href="#md:cherry-picking-api-methods"><span>Cherry-<wbr/>Picking API <wbr/>Methods</span></a></li><li><a href="#md:creating-your-own-api-methods"><span>Creating <wbr/>Your <wbr/>Own API <wbr/>Methods</span></a></li></ul></li><li><a href="#md:aborting-rpc-requests"><span>Aborting RPC <wbr/>Requests</span></a></li></ul></li><li><a href="#md:rpc-subscriptions"><span>RPC <wbr/>Subscriptions</span></a></li><li><ul><li><a href="#md:getting-started-with-rpc-subscriptions"><span>Getting <wbr/>Started with RPC <wbr/>Subscriptions</span></a></li><li><a href="#md:subscriptions-as-asynciterators"><span>Subscriptions as <wbr/>Async<wbr/>Iterators</span></a></li><li><a href="#md:aborting-rpc-subscriptions"><span>Aborting RPC <wbr/>Subscriptions</span></a></li><li><ul><li><a href="#md:subscription-timeout"><span>Subscription <wbr/>Timeout</span></a></li><li><a href="#md:cancelling-subscriptions"><span>Cancelling <wbr/>Subscriptions</span></a></li></ul></li><li><a href="#md:failed-vs-aborted-subscriptions"><span>Failed vs. <wbr/>Aborted <wbr/>Subscriptions</span></a></li><li><a href="#md:message-gap-recovery"><span>Message <wbr/>Gap <wbr/>Recovery</span></a></li><li><a href="#md:using-custom-rpc-subscriptions-transports"><span>Using <wbr/>Custom RPC <wbr/>Subscriptions <wbr/>Transports</span></a></li><li><a href="#md:augmentingconstraining-the-rpc-subscriptions-api"><span>Augmenting/<wbr/>Constraining the RPC <wbr/>Subscriptions API</span></a></li><li><ul><li><a href="#md:constraining-by-cluster-1"><span>Constraining by <wbr/>Cluster</span></a></li><li><a href="#md:including-unstable-subscriptions"><span>Including <wbr/>Unstable <wbr/>Subscriptions</span></a></li><li><a href="#md:cherry-picking-api-methods-1"><span>Cherry-<wbr/>Picking API <wbr/>Methods</span></a></li></ul></li></ul></li><li><a href="#md:keys"><span>Keys</span></a></li><li><ul><li><a href="#md:web-crypto-api"><span>Web <wbr/>Crypto API</span></a></li><li><a href="#md:web-crypto-polyfill"><span>Web <wbr/>Crypto <wbr/>Polyfill</span></a></li><li><a href="#md:string-addresses"><span>String <wbr/>Addresses</span></a></li></ul></li><li><a href="#md:transactions"><span>Transactions</span></a></li><li><ul><li><a href="#md:creating-transaction-messages"><span>Creating <wbr/>Transaction <wbr/>Messages</span></a></li><li><a href="#md:signing-transaction-messages"><span>Signing <wbr/>Transaction <wbr/>Messages</span></a></li><li><a href="#md:calibrating-a-transaction-messages-compute-unit-budget"><span>Calibrating a <wbr/>Transaction <wbr/>Message&#39;s <wbr/>Compute <wbr/>Unit <wbr/>Budget</span></a></li><li><a href="#md:helpers-for-building-transaction-messages"><span>Helpers <wbr/>For <wbr/>Building <wbr/>Transaction <wbr/>Messages</span></a></li></ul></li><li><a href="#md:codecs"><span>Codecs</span></a></li><li><a href="#md:type-safety"><span>Type-<wbr/>Safety</span></a></li><li><ul><li><a href="#md:rpc-types"><span>RPC <wbr/>Types</span></a></li><li><a href="#md:catching-compile-time-bugs-with-typescript"><span>Catching <wbr/>Compile-<wbr/>Time <wbr/>Bugs with <wbr/>Type<wbr/>Script</span></a></li></ul></li><li><a href="#md:compatibility-layer"><span>Compatibility <wbr/>Layer</span></a></li><li><a href="#md:program-clients"><span>Program <wbr/>Clients</span></a></li><li><ul><li><a href="#md:how-does-this-work"><span>How <wbr/>Does <wbr/>This <wbr/>Work?</span></a></li></ul></li><li><a href="#md:create-solana-program"><span>Create <wbr/>Solana <wbr/>Program</span></a></li><li><a href="#md:graphql"><span>GraphQL</span></a></li><li><a href="#md:development"><span>Development</span></a></li><li><a href="#md:thank-you"><span>Thank you</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>Solana JavaScript SDK</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
